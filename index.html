<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rung's Thai Kitchen</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@100..900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Outfit:wght@100..900&display=swap" rel="stylesheet">
  <style>
    :root{
      --accent:#d9464a;
      --accent-dark:#b02a2a;
      --muted:#6b7280;
      --card:#fff;
      --shadow: 0 8px 24px rgba(15,23,42,0.06);
	  --crimson:#CC0C1A;
      font-family: 'Nunito', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#fff 0%,#fff8f6 100%);color:#111;}
    .container{max-width:1100px;margin:0 auto;padding:20px;}

    /* Header */
    /* Header */
.site-header {
  background: var(--card);
  box-shadow: var(--shadow);
  border-radius: 12px;
  margin-bottom: 20px;
  padding: 14px 20px 16px;
  position: sticky;
  top: 12px;
  z-index: 1100;
}

.header-inner.centered {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;
  text-align: center;
}

/* Ticker container sits above the header, stays visible */
#status-ticker {
  position: sticky;
  top: 0;
  z-index: 3000;
  background: #d9464a;
  color: #fff;
  padding: 6px 0;
  box-shadow: 0 2px 8px rgba(0,0,0,.15);
  overflow: hidden;
  white-space: nowrap;
  border-radius: 10px;      /* matches your cards */
  margin: 12px 12px 8px;    /* same insets as your header/card look */
}

/* Scrolling track */
#status-ticker .ticker-track {
  display: inline-flex;
  align-items: center;
  gap: 48px;                 /* space between the two copies */
  will-change: transform;
  animation: tickerMove var(--ticker-speed, 28s) linear infinite;
}

#status-ticker span { font-weight: 700; font-size: 1rem; padding: 0 10px; }

/* Marquee keyframes */
@keyframes tickerMove {
  from { transform: translateX(0); }
  to   { transform: translateX(-50%); } /* one full copy width */
}

/* Header sticks BELOW the ticker */
.site-header {
  position: sticky;
  top: var(--ticker-offset, 12px);
  z-index: 1100;
}

/* Slow it a touch more on small screens */
@media (max-width: 640px) {
  #status-ticker .ticker-track {
    animation-duration: var(--ticker-speed-mobile, 36s);
  }
}



html { scroll-padding-top: calc(var(--header-offset, 0px) + var(--ticker-height, 0px)); }


/* Ensure modals always sit above the ticker */
.modal-backdrop {
  position: fixed;       /* ensure it covers everything */
  inset: 0;
  z-index: 1600;         /* higher than ticker */
}

/* If you also have the success modal separately, keep it above too */
#order-success.modal-backdrop {
  z-index: 1700;
}


/* Checkout status banner */
.checkout-banner {
  display:none;
  margin:10px 0 6px;
  padding:10px 12px;
  border-radius:8px;
  font-size:13px;
  line-height:1.35;
}
.checkout-banner--closed       { background:#fff3f3; color:#8a1f1f; border:1px solid #f2d3d3; }
.checkout-banner--fullybooked  { background:#fff8e6; color:#7a4d00; border:1px solid #f1dfb3; }
.checkout-banner .x {
  float:right; border:none; background:transparent; font-weight:800; cursor:pointer;
}


/* --- Holiday / status ticker --- */
#status-ticker {
  background: linear-gradient(90deg, #b02a2a, #d9464a);
  color: #fff;
  text-align: center;
  font-weight: 600;
  font-size: 0.95rem;
  letter-spacing: 0.02em;
  padding: 8px 12px;
  position: sticky;
  top: 0;
  z-index: 2000;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  overflow: hidden;
}

#status-ticker.hidden { display: none; }

#status-ticker .ticker-inner {
  white-space: nowrap;
  animation: ticker-move 25s linear infinite;
}

@keyframes ticker-move {
  0%   { transform: translateX(100%); }
  100% { transform: translateX(-100%); }
}



.brand-block {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.brand-logo {
  height: 120px;
  width: auto;
  display: block;
}

.brand-title {
  color: var(--crimson);
  font-weight: 800;
  font-size: 1.3rem;
}

.brand-tagline {
  color: var(--muted);
  font-size: 0.9rem;
  letter-spacing: 0.04em;
}

/* Nav */
.main-nav ul {
  display: flex;
  gap: 4px;
  list-style: none;
  padding: 0;
  margin: 0;
  flex-wrap: wrap;
  justify-content: center;
}

.main-nav a {
  color: #111;
  text-decoration: none;
  font-weight: 700;
  font-size: 0.9rem;
  padding: 4px 8px;
  border-radius: 999px;
}

.main-nav a:hover {
  background: rgba(217, 70, 74, 0.1);
}

/* mobile tweaks */
@media (max-width: 640px) {
  .brand-logo {
    height: 90px;
  }
  .main-nav ul {
    gap: 10px;
  }
  .main-nav a {
    font-size: 0.85rem;
  }
}

    .logo{display:flex;align-items:center;gap:10px}
    .logo img {height: 125px; width: auto;}
    nav ul{display:flex;gap:16px;list-style:none;margin:0;padding:0}
    nav a{color:#111;text-decoration:none;font-weight:700;font-size:14px}

    /* Layout */
    /* --- Simplified layout: order panel always below menu --- */
main {
  display: block;
}

#order-panel {
  position: static;
  width: 100%;
  margin-top: 40px;
}

    .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow)}
    h1,h2,h3{margin:0}
    h1{font-size:20px}
    .muted{color:var(--muted)}
    .small{font-size:13px}
    .price{font-weight:800}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;text-decoration:none;font-weight:700;cursor:pointer;font-size:13px}
    .btn-accent{background:var(--accent);color:white;border:none}
    .btn-ghost{background:transparent;border:1px solid #eee}
    .btn[disabled]{opacity:.55;cursor:not-allowed;filter:grayscale(10%)}
	
	/* body { background: #16205B; } */
/* #menu h2::after { ... } */


		header {
	  background: rgba(255,255,255);
	  backdrop-filter: blur(8px);
	}

	.menu-item {
	  background: rgba(255,255,255,0.85);
	  transition: transform .12s ease, box-shadow .12s ease;
	}
	.menu-item:hover {
	  transform: translateY(-2px);
	  box-shadow: 0 4px 16px rgba(217,70,74,0.08);
	}

	.btn-accent {
	  background: linear-gradient(135deg, #d9464a 0%, #b02a2a 100%);
	  box-shadow: 0 6px 16px rgba(217,70,74,0.35);
	}

	#menu h2 {
	  display:flex;
	  align-items:center;
	  gap:6px;
	}
	/* body { background: #16205B; } */
/* #menu h2::after { ... } */



    /* Menu categories (accordion) */
    .menu-section{display:grid;gap:12px}
    .category{border-radius:10px;border:1px solid #f3e7e6;overflow:hidden}
    .category-header{display:flex;justify-content:space-between;align-items:center;padding:12px 14px;background:#fff4f3;cursor:pointer}
    .category-header h3{margin:0;font-size:16px}
    .category-body{
      max-height:0; overflow:hidden;
      transition:max-height .28s ease, padding .28s ease;
      padding:0 12px;
    }
    .category-body.open{ padding:12px; }
	
	/* keep anchors landing below sticky header */
	:root { --header-offset: 120px; }  /* JS will overwrite precisely */
	html { scroll-behavior: smooth; }
	.category, .category-header, .category-body { scroll-margin-top: var(--header-offset); }
	/*html { scroll-padding-top: var(--header-offset); }*/
	
    .menu-item{display:flex;justify-content:space-between;align-items:flex-start;padding:10px;border-radius:8px;border:1px solid #f7efee;margin-bottom:8px}
    .menu-item .meta{max-width:72%}
    .menu-item .meta .title{font-weight:700}

    /* Order */
    aside { align-self: start; }
    #order-panel{ position: sticky; top: 20px; z-index: 1000; width: 100%; }
    .order-list{display:flex;flex-direction:column;gap:10px}
    .order-row{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:8px;border:1px dashed #f0e6e5;gap:10px}
    .item-thumb{width:54px;height:54px;object-fit:cover;border-radius:8px;border:1px solid #eee;background:#f8f8f8}

    /* Our Food gallery */
    .food-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .food-grid img{width:100%;height:140px;object-fit:cover;border-radius:8px;box-shadow:0 6px 16px rgba(15,23,42,0.06);cursor:pointer}
    .food-grid img:hover{transform:translateY(-4px);transition:transform .18s ease,box-shadow .18s ease}

    /* Modal (customise & checkout & success) */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;padding:18px;z-index:1200; overflow:auto; -webkit-overflow-scrolling:touch}
    .modal{width:100%;max-width:720px;background:var(--card);border-radius:12px;padding:16px;box-shadow:0 12px 40px rgba(0,0,0,0.25); max-height:90vh; overflow:auto}
    .mods{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid #eee;cursor:pointer;font-size:13px;background:#fff; min-height:44px; touch-action:manipulation}
    .chip.selected{background:#fff4f3;border-color:var(--accent)}
    input[type=number]{width:72px;padding:8px;border-radius:8px;border:1px solid #e7e3e3}
    .qty-controls{display:flex;align-items:center;gap:8px}
    .totals{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .mod-required-note{margin-top:8px;font-size:13px;color:#b02a2a;display:none}
    .mod-limit-note{margin-top:6px;font-size:12px;color:var(--muted);display:none}

    /* Spice selector */
    .spice-wrap{margin-top:12px}
    .spice-label{font-size:13px;color:var(--muted)}
    .spice-buttons{display:flex;gap:6px;margin-top:6px;flex-wrap:wrap}
    .spice-btn{border:1px solid #eee;background:#fff;border-radius:999px;padding:6px 10px;font-size:13px;cursor:pointer; min-height:44px; touch-action:manipulation}
    .spice-btn.active{border-color:var(--accent);background:#fff4f3}

    /* Allergens */
    .allergen-icon{font-size:14px;margin-right:6px}
    .allergen-badges{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .allergen-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border:1px solid #eee;border-radius:999px;background:#fff;font-size:12px}

    footer{margin-top:18px;text-align:center;padding:18px;border-radius:10px;background:rgba(204,12,26,0.35);color:white; padding-bottom:max(18px, env(safe-area-inset-bottom));}
	footer {
  margin-top: 30px;
  text-align: center;
  padding: 24px 16px;
  border-radius: 12px;
  background: rgba(204,12,26,0.35);
  color: #fff;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
}

footer {
  margin-top: 30px;
  text-align: center;
  padding: 24px 16px;
  border-radius: 12px;
  background: rgba(204,12,26,0.35);
  color: #fff;
  padding-bottom: max(24px, env(safe-area-inset-bottom));
}

.footer-inner {
  max-width: 900px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 14px;
  align-items: center;
}

.footer-section h3 {
  font-weight: 800;
  margin-bottom: 6px;
  color: #fff;
}

.footer-section .muted {
  color: rgba(255,255,255,0.85);
  margin: 0 0 10px;
}

.footer-section a {
  color: #fff;
  text-decoration: underline;
  text-underline-offset: 2px;
}
.footer-section a:hover { opacity: 0.9; }

.footer-divider {
  width: 100%;
  height: 1px;
  background: rgba(255,255,255,0.2);
  margin: 4px 0;
}

.footer-legal {
  display: flex;
  flex-direction: column;
  gap: 6px;
  align-items: center;
}

.footer-links {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: center;
}

.footer-links a {
  color: #fff;
  text-decoration: underline;
  text-underline-offset: 2px;
}
.footer-links a:hover { opacity: 0.9; }

.footer-links .dot {
  opacity: 0.8;
  margin: 0 6px;
}

@media (max-width: 640px) {
  footer { font-size: 0.9rem; }
  .footer-section, .footer-legal { text-align: center; }
}



    /* Checkout form layout/styling */
    #checkout-form > div { margin-top: 10px; }
    .form-grid { display:grid; gap:12px; }
    .form-grid .row-2 { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    @media (max-width:560px){ .form-grid .row-2 { grid-template-columns:1fr; } }
    .field { display:flex; flex-direction:column; gap:6px; }
    .field label { font-size:13px; color:var(--muted); }
    .input, .textarea, .select {
      font: inherit;
      padding: 10px 12px;
      border-radius: 8px;
      border: 1px solid #e7e3e3;
      background:#fff;
      outline: none;
      box-shadow: none;
    }
    .input:focus, .textarea:focus, .select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(217,70,74,.12);
    }
    .input.auto-fit { width:auto; max-width:100%; min-width:18ch; white-space:nowrap; }
    .input-measure { position:absolute; visibility:hidden; white-space:pre; font:inherit; padding:10px 12px; border:1px solid transparent; }
	/* ===== mobile / small screens ===== */
@media (max-width: 900px) {
  /* header: stack logo above nav, but keep nav links horizontal */
  header {
    position: static;
  }
  .header-inner {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: 8px;
  }

  /* nav: horizontal list that wraps nicely */
  nav ul {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px 14px;
    padding: 0;
    margin: 0;
    list-style: none;
  }

  nav ul li {
    display: inline-block;
  }

  nav a {
    font-size: 0.95rem;
    padding: 4px 8px;
  }

  /* main layout: single column, order summary below menu */
 /* main {
    display: block;
  }

  #order-panel {
    position: static;
    width: 100%;
    margin-top: 20px;
  }*/

	  #order-success .order-line {
	  display:flex;
	  justify-content:space-between;
	  gap:12px;
	  align-items:flex-start;
	}
		#order-success .order-line-left {
		  display:flex;
		  flex-wrap:wrap;
		  gap:4px;
		  align-items:cente
		}
		#order-success .spice {
		  display:inline-block;
		  min-width:3.2rem; /* keeps üå∂Ô∏è from jumping */
		}


  /* menu items: full width on mobile */
  .menu-item {
    flex-direction: column;
    gap: 8px;
  }
}
/* === Parallax background layer === */
.bg-parallax {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  overflow: hidden;
  background:
    /* top image */
    url("./images/bg-top6.JPG?v=2") center top / cover no-repeat,
    /* bottom image */
    url("images/bg-bottom.jpg") center 120vh / cover no-repeat,
    /* fallback colour under both */
    #0b1120;
  background-attachment: fixed, fixed, scroll;
  /* dim it a bit so text stays readable */
  filter: brightness(.55);
}

/* extra spacing between sections so we *see* the background */
.card {
  margin-bottom: 175px;   /* was 14‚Äì18px in places */
}

/* give main a bit more vertical rhythm */
main > section > .card + .card {
  margin-top: 250px;
}

/* keep footer off the bottom a little so background shows */
footer {
  margin-top: 30px;
}

/* mobile fallback: iOS hates background-attachment:fixed */
@media (max-width: 768px) {
  .bg-parallax {
    background-attachment: scroll, scroll, scroll;
    background-size: cover, cover, auto;
  }
}
.card {
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(2px);
}

/* This helps anchors or programmatic scrolls land below the sticky header */
:root {
  --header-offset: 160px; /* fallback; JS will set the precise value */
}

html {
  scroll-behavior: smooth;                 /* native smooth scroll */
  scroll-padding-top: var(--header-offset);/* space for sticky header */
}

.category-body {
  transition: max-height .25s ease;        /* a touch shorter & snappier */
  will-change: max-height;                 /* hint for smoother anim */
  overflow: hidden;
}


/*.card-spacer { margin-bottom: 180px; }
.card { margin-bottom: 0; } */

getComputedStyle(document.documentElement).getPropertyValue('--header-offset')
/* === Checkout modal alignment fixes === */
#checkout-modal .totals{
  display:grid;
  grid-template-columns: 1fr auto; /* label on left, amount on right */
  gap:12px;
  align-items:center;
}
#checkout-modal .totals .muted{ white-space:nowrap; }

#checkout-subtotal,
#checkout-delivery,
#checkout-total{
  min-width:6ch;     /* avoids clipping like ¬£9.50 */
  text-align:right;  /* right-align prices */
}

/* Inputs layout */
#checkout-form .form-grid{ display:grid; gap:12px; }
#checkout-form .row-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}
@media (max-width:560px){
  #checkout-form .row-2{ grid-template-columns:1fr; }
}

/* Modal padding & actions bar */
#checkout-modal .modal{ padding:16px 18px; }
#checkout-modal .checkout-actions{
  position:sticky;
  bottom:0;
  background:#fff;
  padding-top:8px;
  margin-top:6px;
}

/* Ensure modal sits above ticker */
#checkout-modal{ z-index:1400; }
#status-ticker{ z-index:900; }

/* === Order summary row layout (desktop & mobile) === */
#order-panel .order-list { overflow: visible; }

#order-panel .order-row {
  display: grid;
  /* image | wide name/details | price */
  grid-template-columns: 64px minmax(0, 1fr) auto;
  align-items: center;
  gap: 12px;
}

#order-panel .order-row .item-thumb {
  width: 64px; height: 64px; object-fit: cover; border-radius: 8px;
}

/* let the middle column actually grow */
#order-panel .order-row .meta { min-width: 0; max-width: 100%; overflow: hidden; }

/* DESKTOP/TABLET: single-line with ellipsis */
#order-panel .order-row .meta .title {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 700;
}

/* price column stays tight and aligned right */
#order-panel .order-row .price,
#order-panel .order-row .order-price {
  white-space: nowrap;
  text-align: right;
  min-width: 6ch;
  justify-self: end;
}

/* MOBILE: allow two lines for long names */
@media (max-width: 768px) {
  #order-panel .order-row {
    grid-template-columns: 54px minmax(0, 2fr) auto;
    gap: 10px;
  }
  #order-panel .order-row .meta .title {
    display: -webkit-box;
    -webkit-line-clamp: 2;       /* up to 2 lines on mobile */
    -webkit-box-orient: vertical;
    white-space: normal;
  }
}
/* --- Order rows: flex layout, name gets the space --- */
#order-panel .order-list .order-row{
  display: flex !important;
  align-items: flex-start;
  gap: 12px;
}

/* thumbnail stays fixed */
#order-panel .order-row .item-thumb{
  flex: 0 0 64px;
  width: 64px;
  height: 64px;
}

/* NAME / meta column should grow and be wide enough */
#order-panel .order-row .meta{
  flex: 1 1 520px;       /* <-- give it most of the width */
  min-width: 320px;      /* prevent crazy narrow column on desktop */
  max-width: 100%;
}

/* keep price / qty / remove tight and on the right */
#order-panel .order-row .price,
#order-panel .order-row .qty-controls,
#order-panel .order-row a[href*="remove"],
#order-panel .order-row .remove{
  flex: 0 0 auto;
  white-space: nowrap;
}

/* push the price to the far right; others will sit before it */
#order-panel .order-row .price{ margin-left: auto; }

/* stop titles from breaking letter-by-letter */
#order-panel .order-row .meta .title{
  white-space: normal;
  word-break: normal;
  overflow-wrap: anywhere;   /* wrap at word boundaries when needed */
}

/* mobile tweak */
@media (max-width: 640px){
  #order-panel .order-row .item-thumb{ flex-basis: 54px; width: 54px; height: 54px; }
  #order-panel .order-row .meta{ flex-basis: 260px; min-width: 200px; }
}

/* --- force one-column layout everywhere --- */
main{ display:block !important; }
#order-panel{
  position:static !important;
  width:100% !important;
  margin-top:20px !important;
}

#ticker-ghost, .ticker-spacer { display:none !important; }

/* --- Order summary: mobile-friendly layout & wrapping --- */
.order-row {
  display: grid;
  grid-template-columns: 68px 1fr auto; /* thumb | name | price */
  align-items: center;
  gap: 12px;
}

.order-row .item-thumb {
  width: 68px;
  height: 68px;
  border-radius: 8px;
  object-fit: cover;
}

.order-row .meta {
  min-width: 0;                 /* allow text to take available space */
}

.order-row .meta .title {
  white-space: normal;          /* allow multi-line names */
  word-break: keep-all;         /* don't break inside words */
  overflow-wrap: break-word;    /* but wrap long words if needed */
  line-height: 1.25;
}

.order-row .price {
  justify-self: end;            /* keep prices neatly aligned right */
}

/* Very narrow phones: put controls on the next line, keep price aligned */
@media (max-width: 420px) {
  .order-row {
    grid-template-columns: 56px 1fr;   /* drop the dedicated price column */
  }
  .order-row .price {
    grid-column: 2; justify-self: end; /* price sits in the name column row */
  }
  .order-row .qty-controls,
  .order-row .remove {
    grid-column: 2;                    /* controls flow beneath the name */
  }
}
/* Override older width limits for order summary text */
.order-row .meta {
  max-width: none !important;
}


<script>
console.info('Console levels forced');
console.log = console.info = console.debug = console.warn = console.error = console.log.bind(console);
</script>
/* --- Order summary layout: mobile fix (portrait) --- */
@media (max-width: 520px) {
  /* 3-column grid: [thumb] [flex text] [fixed price] */
  .order-row {
    display: grid;
    grid-template-columns: 64px minmax(0, 1fr) 84px; /* tweak 84px if needed */
    column-gap: 12px;
    align-items: start;
  }

  .order-row .item-thumb {
    grid-column: 1 / 2;
    width: 64px; height: 64px;
    flex: none;
  }

  /* text/meta column grows and can actually shrink (min-width:0 is key in grid) */
  .order-row .meta {
    grid-column: 2 / 3;
    min-width: 0 !important;
    max-width: none !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: anywhere;
  }
  .order-row .meta .title {
    min-width: 0 !important;
    white-space: normal !important;
    word-break: normal !important;
    overflow-wrap: anywhere;
  }

  /* fixed price column stays right-aligned and on one line */
  .order-row .price {
    grid-column: 3 / 4;
    justify-self: end;
    text-align: right;
    white-space: nowrap;
  }

  /* controls & remove sit under the text, not under price */
  .order-row .qty-controls,
  .order-row .remove-link {
    grid-column: 2 / 3;
    justify-self: start;
    margin-top: 6px;
  }
}


  </style>
</head>
<body>
<body>
  <div class="bg-parallax" aria-hidden="true"></div>
  <div class="container">
    <!-- your existing header / main / etc -->

  <div class="container">
<!-- Status Ticker -->
<div id="status-ticker" class="hidden" role="status" aria-live="polite">
  <div class="ticker-track">
    <span id="ticker-text">We‚Äôre closed this Sunday for a private event ‚Äî thank you!</span>
    <span class="ticker-dup" aria-hidden="true"></span>
  </div>
</div>


<!-- Then your header -->
<header class="site-header"> ... </header>

    <!-- Header -->
    <header class="site-header">
  <div class="header-inner centered">
    <div class="brand-block">
      <img src="images/RTKWhite1.png" alt="Rung's Thai Kitchen Logo" class="brand-logo">
      <!--<div class="brand-title">Rung's Thai Kitchen</div>-->
      <div class="brand-title">Authentic Thai Takeaway</div>
    </div>

    <nav class="main-nav">
      <ul>
        <li><a href="#about">About</a></li>
        <li><a href="#our-food">Our Food</a></li>
        <li><a href="#allergens">Allergens</a></li>
        <li><a href="#menu">Menu</a></li>
        <!--<li><a href="#order">Order</a></li>-->
        <li><a href="#contact">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>
<div id="status-ticker" class="hidden">
  <div class="ticker-inner">
    <span id="ticker-text">We‚Äôre closed for Songkran Festival, reopening 18 April üéâ</span>
  </div>
</div>
<script>
(function(){
  const el = document.getElementById('ticker-text');
  if(!el) return;

  // pixels per second ‚Üí smaller = slower
  const pxPerSec = 40;

  // measure after layout
  requestAnimationFrame(() => {
    const w = el.getBoundingClientRect().width || 0;
    // ensure a minimum duration
    const seconds = Math.max(15, Math.ceil(w / pxPerSec));
    el.style.animationDuration = seconds + 's';
  });
})();
</script>


    <main>
      <!-- Left column -->
      <section>
        <!-- About -->
        <!--<div class="card-spacer">-->
		<div class="card" id="about" style="margin-top:8px">
          <h2>About Rung's Thai Kitchen</h2>
          <p class="muted">
            Welcome to Rung's Thai Kitchen, where I take pride in delivering authentic Thai takeaway food right to your doorstep in Leeds.</p>
			<p class="muted"> My culinary journey began with a passion for traditional Thai recipes handed down through generations. I believe that the secret to great Thai cuisine lies in using fresh, high-quality ingredients and a careful balance of flavours. Each dish is crafted with love and dedication, ensuring that you experience the vibrant and aromatic taste of Thailand in every bite.</p>
			<p class="muted">Whether you're craving a comforting curry or a refreshing salad, I've got you covered.
          </p>
        </div>
		<!--</div>-->

        <!-- Our Food -->
        <!--<div class="card-spacer">-->
		<div class="card" id="our-food" style="margin-top:8px">
          <h2>Our Food</h2>
          <div style="display:flex;gap:18px;align-items:flex-start;flex-wrap:wrap">
            <div style="flex:1 1 320px;min-width:240px">
              <p class="muted">
                At Rung's Thai Kitchen we use fresh, locally sourced ingredients and traditional Thai techniques.
                Our dishes are prepared to order ‚Äî bold flavours, balanced spice, and a focus on bright, fresh herbs.
              </p>
              <p class="muted" style="margin-top:8px">
                If you have dietary requirements please mention them when placing your order. We adapt where we can.
              </p>
            </div>
            <div style="flex:1 1 360px;min-width:260px">
              <div class="food-grid" id="food-grid">
                <img src="images/SpringRoll.jpg" alt="Spring Rolls" loading="lazy" />
                <img src="images/Prawns.jpg" alt="Deep Fried Tiger Prawns" loading="lazy" />
                <img src="images/TomYum.jpg" alt="Tom Yum" loading="lazy" />
                <img src="images/thaifishcakesjpg.jpg" alt="Thai Fish Cakes" loading="lazy" />
                <img src="images/somtam.jpg" alt="Papaya salad" loading="lazy" />
                <img src="images/PrawnCrackers.jpg" alt="Prawn Crackers" loading="lazy" />
              </div>
            </div>
          </div>
        </div>
		<!--</div>-->

        <!-- Allergens -->
        <!--<div class="card-spacer">-->
		<div class="card" id="allergens" style="margin-top:14px">
          <h2 style="margin-bottom:10px">Allergens & Ingredients</h2>
          <p class="muted">
            We take food allergies seriously. Many of our dishes can be prepared without certain allergens ‚Äî please
            mention any allergies when placing your order. The icons below indicate dishes that contain:
          </p>
          <div style="margin-top:10px;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:10px;line-height:1.5">
            <div><span class="allergen-icon">ü•ú</span> Peanuts</div>
            <div><span class="allergen-icon">üå∞</span> Tree Nuts</div>
            <div><span class="allergen-icon">üåæ</span> Gluten (Cereals)</div>
            <div><span class="allergen-icon">ü¶ê</span> Crustaceans (Shellfish)</div>
            <div><span class="allergen-icon">ü¶™</span> Molluscs (e.g. squid, mussels)</div>
            <div><span class="allergen-icon">ü•õ</span> Milk / Dairy</div>
            <div><span class="allergen-icon">üç≥</span> Egg</div>
            <div><span class="allergen-icon">üêü</span> Fish</div>
            <div><span class="allergen-icon">üåø</span> Celery</div>
            <div><span class="allergen-icon">üåº</span> Lupin</div>
            <div><span class="allergen-icon">&#x1F331;</span> Mustard</div>
            <div><span class="allergen-icon">‚ö´</span> Sesame Seeds</div>
            <div><span class="allergen-icon">ü´ò</span> Soya</div>
            <div><span class="allergen-icon">üí®</span> Sulphur Dioxide / Sulphites</div>
            <div><span class="allergen-icon">üå∂Ô∏è</span> Spice Level (heat indicator)</div>
          </div>
        </div>
		<!--</div>-->

        <!-- Menu -->
        <!--<div class="card-spacer">-->
		<div class="card" id="menu" style="margin-top:14px">
          <h2 style="margin-bottom:10px">Menu</h2>
          <div class="menu-section" id="menu-list"><!-- built by JS --></div>
        </div>
		<!--</div>-->
      </section>

      <!-- Right column: Order -->
      <aside>
        <div class="card" id="order-panel">
          <h2>Your Order</h2>
          <div id="order-list" class="order-list" style="margin-top:12px">
            <div class="muted small">No items yet ‚Äî add something from the menu.</div>
          </div>
          <div class="totals" style="margin-top:14px">
            <div class="muted small">Total</div>
            <div id="order-total" style="font-weight:800">¬£0.00</div>
          </div>
          <button id="open-checkout" type="button" class="btn btn-accent" style="width:100%;margin-top:12px">Proceed to Checkout</button>
          <div id="order-msg" class="muted small" style="margin-top:8px"></div>
        </div>
      </aside>
    </main>

   <footer id="contact">
  <div class="footer-inner">
    <div class="footer-section">
      <h3>Contact Us</h3>
      <p class="muted">
        üìû <a href="tel:01133447431">0113 3447431</a> &nbsp; ‚Ä¢ &nbsp;
        ‚úâÔ∏è <a href="mailto:hello@rungsthaikitchen.co.uk">hello@rungsthaikitchen.co.uk</a>
      </p>

      <h3>Opening Hours</h3>
      <p class="muted">üïí Wed‚ÄìSun: 17:00 ‚Äì 21:00</p>
    </div>

    <div class="footer-divider"></div>

    <div class="footer-legal">
      <div class="footer-copy">
        ¬© <span id="year"></span> Rung‚Äôs Thai Kitchen. All rights reserved.
      </div>
      <nav class="footer-links" aria-label="Legal">
        <a href="privacypolicy.html" target="_blank" rel="noopener">Privacy Policy</a>
        <span class="dot">‚Ä¢</span>
        <a href="cookiepolicy.html" target="_blank" rel="noopener">Cookie Policy</a>
      </nav>
    </div>
  </div>
</footer>



  </div>

  <!-- customise Modal -->
  <div id="modal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div id="modal-title" style="font-weight:800">customise</div>
          <div id="modal-base" class="muted small" style="margin-top:4px" data-price="0">Base price: ¬£0.00</div>
        </div>
        <button id="modal-close" class="btn btn-ghost">Close</button>
      </div>

      <img id="modal-img" alt="" style="margin-top:10px;width:100%;max-height:220px;object-fit:cover;border-radius:10px;display:none">

      <div style="display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px">
        <div>
          <label class="small">Quantity</label>
          <div class="qty-controls" style="margin-top:6px">
            <button id="qty-decr" class="btn btn-ghost">-</button>
            <input id="qty-input" type="number" min="1" value="1" />
            <button id="qty-incr" class="btn btn-ghost">+</button>
          </div>
        </div>
      </div>

      <div style="margin-top:12px">
        <div class="small">Modifiers (protein / extras)</div>
        <div id="mods" class="mods"></div>
        <div id="mod-required-note" class="mod-required-note">Please choose at least one option to continue.</div>
        <div id="mod-limit-note" class="mod-limit-note"></div>
      </div>

      <div id="modal-allergens-wrap" style="margin-top:10px;display:none">
        <div class="small">Allergens in this dish</div>
        <div id="modal-allergens" class="allergen-badges"></div>
      </div>

      <div id="spice-wrap" class="spice-wrap" style="display:none">
        <div class="spice-label">Spice level</div>
        <div id="spice-buttons" class="spice-buttons"></div>
      </div>

      <div class="totals" style="margin-top:12px">
        <div class="muted small">Unit price</div>
        <div id="unit-price" style="font-weight:800">¬£0.00</div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:14px">
        <button id="modal-cancel" class="btn btn-ghost">Cancel</button>
        <button id="modal-add" class="btn btn-accent">Add to basket</button>
      </div>
    </div>
  </div>

  <!-- Checkout Modal -->
  <div id="checkout-modal" class="modal-backdrop" style="display:none" aria-modal="true" role="dialog">
    <div class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:800">Customer details</div>
          <div class="muted small" style="margin-top:4px">We‚Äôll save with your order.</div>
        </div>
        <button id="checkout-close" class="btn btn-ghost">Close</button>
      </div>
		<div id="checkout-banner" class="checkout-banner" role="status" aria-live="polite"></div>

      <form id="checkout-form" class="form-grid">
        <div class="field">
          <label for="cust-name">Full name</label>
          <input id="cust-name" name="name" type="text" autocomplete="name" required class="input auto-fit" required>
        </div>

        <div class="row-2">
          <div class="field">
            <label for="cust-email">Email</label>
            <input id="cust-email" name="email" type="email" inputmode="email" autocomplete="email" class="input auto-fit" required>
          </div>
          <div class="field">
            <label for="cust-phone">Phone</label>
            <input id="cust-phone" name="phone" type="tel" inputmode="tel" autocomplete="tel" required class="input auto-fit" required>
          </div>
        </div>

        <div class="field">
          <label for="cust-address">Address (flat/house number, street name & post code please)<span id="addr-required-hint" class="muted small">(required for delivery)</span></label>
          <input id="cust-address" name="address" type="text" autocomplete="street-address"
                 inputmode="text" class="input auto-fit" placeholder="House no., street, town, postcode">
        </div>
		

        <div class="field">
          <label>Order type</label>
          <div style="display:flex;gap:12px;align-items:center">
            <label><input type="radio" name="order-type" id="order-type-collection" value="collection" checked> Collection</label>
            <label><input type="radio" name="order-type" id="order-type-delivery" value="delivery"> Delivery</label>
          </div>
          <div id="delivery-note" class="muted small" style="margin-top:4px;display:none">
            Delivery is ¬£3 for orders under ¬£20, free for ¬£20 and above.
          </div>
        </div>

        <!-- Preferred time -->
        <div class="field">
          <label for="cust-preferred-time">Preferred collection/delivery time</label>
          <input id="cust-preferred-time" name="preferred_time" type="datetime-local" class="input" step="300">
          <div class="muted small">We‚Äôll do our best to meet this time. We‚Äôll contact you to confirm.</div>
        </div>

        <div class="field">
          <label for="cust-notes">Notes (optional)</label>
          <input id="cust-notes" name="notes" type="text" class="input auto-fit"
                 placeholder="Allergies, delivery instructions, etc.">
        </div>

        <div class="totals">
          <div class="muted small">Subtotal</div>
          <div id="checkout-subtotal" style="font-weight:800">¬£0.00</div>
        </div>
        <div class="totals">
          <div class="muted small">Delivery Fee</div>
          <div id="checkout-delivery" style="font-weight:800">¬£0.00</div>
        </div>
        <div class="totals">
          <div class="muted small">Total</div>
          <div id="checkout-total" style="font-weight:800">¬£0.00</div>
        </div>

        <div class="checkout-actions" style="display:flex;justify-content:flex-end;gap:8px;margin-top:4px;position:sticky;bottom:0;background:#fff;padding-top:8px">
          <button type="button" id="checkout-cancel" class="btn btn-ghost">Cancel</button>
          <button type="submit" id="checkout-submit" class="btn btn-accent">Place order</button>
        </div>
        <div id="checkout-msg" class="muted small" style="margin-top:6px"></div>
      </form>
    </div>
  </div>

  <!-- Order Success Modal -->
<div id="order-success" class="modal-backdrop" style="display:none" role="dialog" aria-modal="true">
  <div class="modal" style="max-width:560px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">
      <h3 id="order-success-title" style="margin:0">Order placed</h3>
      <button id="order-success-x" class="btn btn-ghost" type="button">√ó</button>
    </div>

    <div id="order-success-msg" class="muted small" style="margin-bottom:10px"></div>

    <div id="order-success-items" class="small"
         style="max-height:260px;overflow:auto;border:1px solid #eee;
                border-radius:8px;padding:8px;margin-bottom:10px">
    </div>

    <div class="totals">
      <div class="muted small">Total</div>
      <div id="order-success-total" style="font-weight:800">¬£0.00</div>
    </div>

    <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:12px">
	  <button id="order-success-pdf" class="btn btn-ghost" type="button">Download receipt</button>
	  <button id="order-success-close" class="btn btn-accent" type="button">OK</button>
	</div>

  </div>
</div>


  <script>
	document.addEventListener('DOMContentLoaded', () => {
  // ---------- Allergen registry ----------
  const ALLERGENS = {

      peanuts:   { icon:'ü•ú',        label:'Peanuts' },
      tree_nuts: { icon:'üå∞',        label:'Tree Nuts' },
      gluten:    { icon:'üåæ',        label:'Gluten (Cereals)' },
      shellfish: { icon:'ü¶ê',        label:'Crustaceans (Shellfish)' },
      molluscs:  { icon:'ü¶™',        label:'Molluscs' },
      dairy:     { icon:'ü•õ',        label:'Milk / Dairy' },
      egg:       { icon:'üç≥',        label:'Egg' },
      fish:      { icon:'üêü',        label:'Fish' },
      celery:    { icon:'üåø',        label:'Celery' },
      lupin:     { icon:'üåº',        label:'Lupin' },
      mustard:   { icon:'&#x1F331;', label:'Mustard' },
      sesame:    { icon:'‚ö´',        label:'Sesame Seeds' },
      soya:      { icon:'ü´ò',        label:'Soya' },
      sulphites: { icon:'üí®',        label:'Sulphur Dioxide / Sulphites' },
      spicy:     { icon:'üå∂Ô∏è',       label:'Spicy (heat)' }
    };
    function normalizeAllergens(list){
      const out = [];
      (list || []).forEach(k => { if (k === 'nuts') out.push('peanuts','tree_nuts'); else out.push(k); });
      return [...new Set(out)];
    }
    function renderAllergenIconsCompact(list){
      const normalized = normalizeAllergens(list);
      if(!normalized.length) return '';
      const spans = normalized.map(key => {
        const a = ALLERGENS[key]; if(!a) return '';
        return `<span class="allergen-icon" title="${a.label}" aria-label="${a.label}">${a.icon}</span>`;
      }).join(' ');
      return `<div class="muted small">${spans}</div>`;
    }
    function renderAllergenBadges(list){
      const normalized = normalizeAllergens(list);
      if(!normalized.length) return '';
      return normalized.map(key => {
        const a = ALLERGENS[key]; if(!a) return '';
        return `<span class="allergen-badge" title="${a.label}" aria-label="${a.label}">
                 <span class="allergen-icon">${a.icon}</span><span>${a.label}</span>
               </span>`;
      }).join('');
    }
	
    // ---------- Data ----------
    const MENU_CATEGORIES = [
      { id: 'starters', title: 'Starter', items: [
        { id: 'veg-spring-rolls', name: 'Vegetable Spring Rolls (x4)', desc: 'Crispy, deep-fried rolls filled with a savoury mixture of glass noodles and vegetables, served with a sweet chilli sauce.', price: 4.50, allergens: ['gluten'] },
        { id: 'chicken-satay', name: 'Chicken Satay', desc: 'Marinated chicken skewers with peanut sauce.', price: 5.00, allergens: ['peanuts','soya','sesame'] },
        { id: 'prawn-crackers', name: 'Prawn Crackers', desc: 'Light, crunchy snacks with sweet chilli sauce.', price: 2.50, allergens: ['shellfish','gluten'] },
        { id: 'moo-ping', name: 'Pork Skewer (Moo Ping)', desc: 'Sweet & savoury grilled pork skewers.', price: 5.00, allergens: [] },
        { id: 'chicken-spring-rolls', name: 'Chicken Spring Rolls (x4)', desc: 'Crispy, deep-fried rolls filled with a savoury mixture of meat, glass noodles, and vegetables, served with a sweet chilli sauce.', price: 5.00, allergens: ['gluten'] },
        { id: 'fried-tofu', name: 'Deep Fried Tofu', desc: 'Crispy Thai Fried Tofu with a sweet-spicy Thai peanut sauce!', price: 3.50, allergens: ['soya','peanuts','sesame'] },
        { id: 'fish-cakes', name: 'Thai Fish Cakes', desc: 'Flavourful, bite-sized fritters with a blend of savoury, spicy, and tangy flavours.', price: 5.00, spiceEnabled: true, spiceDefault: 1, allergens: ['fish','egg','soya'] },
        { id: 'porkprawn-dumplings', name: 'Pork & Prawn Steamed Dumplings', desc: ' Steamed dumplings filled with a savoury combination of tender pork and juicy prawns.', price: 4.50, allergens: ['gluten','shellfish'] },
        { id: 'fried-prawns', name: 'Deep Fried Tiger Prawns (x4)', desc: 'Tiger Prawns cooked in a crispy tempura batter served with Authentic Thai sweet Chilli Sauce.', price: 6.00, allergens: ['shellfish','gluten','egg'] },
        { id: 'thai-sausage', name: 'Thai Pork Sausage', desc: 'A traditional fermented Thai sausage made with ground pork, sticky rice, and fragrant seasonings. Served with fresh sliced ginger, whole peanuts and slices of cucumber.', price: 5.00, allergens: [] }
      ]},
      { id: 'soup', title: 'Soup', items: [
        { id: 'tom-yum', name: 'Tom Yum Soup üå∂Ô∏èüå∂Ô∏è', desc: 'A vibrant and aromatic Thai classic featuring a hot and sour clear broth infused with lemongrass, galangal, and kaffir lime leaves.', price: 6.50, allowedModifiers: ['chicken','prawn','tofu','vegetable'], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 2, allergens: ['fish','soya'] },
        { id: 'tom-kha', name: 'Tom Khaüå∂Ô∏è', desc: 'A creamy and aromatic Thai coconut soup featuring fragrant galangal, lemongrass, and kaffir lime leaves.', price: 5.50, allowedModifiers: ['chicken','prawn','tofu','vegetable'], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 1, allergens: ['fish','dairy'] },
        { id: 'dumpling-broth', name: 'Chicken Steamed Dumplings Broth (Gaew Naam)', desc: 'A savoury and flavourful broth with fragrant chicken-stuffed wontons.', price: 5.50, allergens: ['gluten','egg','soya'] }
      ]},
      { id: 'salad', title: 'Salad', items: [
        { id: 'papaya-salad', name: 'Green Papaya Salad (Som Tam)üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è', desc: 'A spicy, savoury, and sweet Thai salad made primarily of shredded green papaya.', price: 7.00, spiceEnabled: true, spiceDefault: 3, allergens: ['peanuts','fish','soya'] },
        { id: 'beef-salad', name: 'Spicy Beef Salad (Yum Nuea)üå∂Ô∏èüå∂Ô∏è', desc: 'A classic Thai salad with juicy grilled steak, tossed with crisp vegetables, fresh mint, coriander, and a tangy lime-fish sauce dressing.', price: 9.00, spiceEnabled: true, spiceDefault: 2, allergens: ['fish','soya'] },
        { id: 'pork-salad', name: 'Grilled Pork Salad (Nam Tok)üå∂Ô∏è', desc: 'This classic North-eastern Thai salad features smoky, charred grilled pork slices tossed with a fiery dressing of lime, fish sauce, and chili flakes.', price: 8.50, spiceEnabled: true, spiceDefault: 1, allergens: ['fish'] },
        { id: 'laab', name: 'Laabüå∂Ô∏èüå∂Ô∏è', desc: 'A vibrant and flavourful meat salad known for its harmony of spicy, sour, salty, and savoury flavours.', price: 8.00, spiceEnabled: true, spiceDefault: 2, allergens: ['fish'] }
      ]},
      { id: 'curry', title: 'Curry', items: [
        { id: 'rung-curry', name: 'Chefs Special Rainbow Curryüå∂Ô∏è', desc: 'Rich, mildly spiced curry.', price: 9.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 1, allergens: ['fish','soya'] },
        { id: 'green-curry', name: 'Green Curryüå∂Ô∏èüå∂Ô∏è', desc: 'Creamy coconut curry with green chilli paste.', price: 9.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, modifierMax: 2, img: 'images/greencurry.jpg', spiceEnabled: true, spiceDefault: 2, allergens: ['fish','soya'] },
        { id: 'red-curry', name: 'Red Curryüå∂Ô∏è', desc: 'Coconut milk, red curry paste, Thai basil.', price: 9.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 1, allergens: ['fish','soya'] },
        { id: 'massaman-curry', name: 'Massaman Curry', desc: 'Mild curry with potatoes, onions, peanuts.', price: 9.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 0, allergens: ['peanuts','fish','soya'] },
        { id: 'panang-curry', name: 'Panang Curryüå∂Ô∏è', desc: 'Thick, savory-sweet red curry with lime.', price: 9.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 1, allergens: ['fish','soya'] }
      ]},
      { id: 'stir-fry', title: 'Stir Fry', items: [
        { id: 'stir-basil', name: 'Stir Fried Chilli & Basil (Pad Kra Pao)üå∂Ô∏èüå∂Ô∏è', desc: 'Street food classic with holy basil.', price: 8.50, allowedModifiers: ['chicken','beef','pork','tofu','vegetable','prawn','fried-egg' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 2, allergens: ['soya'] },
        { id: 'stir-ginger', name: 'Stir Fried Ginger (Pad Khing)üå∂Ô∏è', desc: 'Zesty ginger-forward stir fry.', price: 8.50, allowedModifiers: ['chicken','beef','pork','tofu','vegetable','prawn' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 1, allergens: ['soya'] },
        { id: 'stir-cashew', name: 'Stir Fried Cashew Nuts', desc: 'Chicken, cashews, veg, savory-sweet sauce.', price: 8.50, allowedModifiers: ['batter-chicken','tofu' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 1, allergens: ['tree_nuts','soya','sesame'] },
        { id: 'stir-sweetsour', name: 'Sweet & Sour (Pad Priew Wan)', desc: 'Veg, pineapple, peppers, onions, tomatoes.', price: 8.50, allowedModifiers: ['batter-chicken','tofu' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 0, allergens: ['soya'] },
        { id: 'stir-yellow', name: 'Stir Fried Yellow Curry (Pad Pong Karee)', desc: 'Mild yellow curry stir-fry.', price: 8.50, allowedModifiers: ['chicken','beef','pork','tofu','vegetable','prawn' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 1, allergens: ['egg','soya','mustard'] },
        { id: 'stir-chilli', name: 'Stir Fried Chilli Paste (Pad Nam Prik Pao)üå∂Ô∏èüå∂Ô∏è', desc: 'Roasted chilli paste sauce.', price: 8.50, allowedModifiers: ['chicken','beef','pork','tofu','vegetable','prawn' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 2, allergens: ['soya'] },
        { id: 'stir-pepper', name: 'Stir Fried Black Pepper Sauce', desc: 'Aromatic black pepper sauce.', price: 7.50, allowedModifiers: ['batter-chicken','beef','pork','tofu','vegetable','prawn' ], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 1, allergens: ['soya'] }
      ]},
      { id: 'noodles', title: 'Noodles & Rice', items: [
        { id: 'chef-pad-thai', name: 'Chefs Special Pad Thaiüå∂Ô∏è', desc: 'Rice noodles, tamarind, egg, bean sprouts.', price: 8.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 1, allergens: ['egg','fish','soya','peanuts'] },
        { id: 'pad-thai', name: 'Pad Thai', desc: 'Rice noodles, tamarind sauce, egg, bean sprouts.', price: 8.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 0, allergens: ['egg','fish','soya','peanuts'] },
        { id: 'pad-see-ew', name: 'Thai Stir Fried Noodles (Pad See Ew)', desc: 'Wide rice noodles, Chinese broccoli, egg.', price: 8.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, modifierMax: 2, spiceEnabled: true, spiceDefault: 0, allergens: ['egg','soya'] },
        { id: 'fried-rice', name: 'Thai Special Fried Rice (Khao Pad)', desc: 'Aromatic jasmine rice, classic seasoning.', price: 7.50, allowedModifiers: ['chicken','tofu','pork','beef','vegetable','prawn'], modifierRequired: true, spiceEnabled: true, spiceDefault: 0, allergens: ['egg','soya'] }
      ]},
      { id: 'sides', title: 'Side Dishes', items: [
        { id: 'jasmine-rice', name: 'Jasmine Rice (Khao Suay)', desc: 'Fragrant, long-grain rice.', price: 2.00, allergens: [] },
        { id: 'egg-rice', name: 'Egg Fried Rice (Khao Pad Khai)', desc: 'Rice with egg, simple & comforting.', price: 2.50, allergens: ['egg','soya'] },
        { id: 'sticky-rice', name: 'Sticky Rice (Khao Neow)', desc: 'Perfect sticky jasmine rice.', price: 2.50, allergens: [] },
        { id: 'coconut-ricee', name: 'Coconut Rice (Khao Man)', desc: 'Jasmine rice simmered in coconut milk.', price: 3.00, allergens: ['dairy'] }
      ]}
    ];

    const MODIFIERS = [
      { id: 'chicken', name: 'Chicken', delta: 0.00 },
      { id: 'beef', name: 'Beef', delta: 1.00 },
      { id: 'pork', name: 'Pork', delta: 0.75 },
      { id: 'tofu', name: 'Tofu', delta: 0.00 },
      { id: 'prawn', name: 'Prawn', delta: 1.50 },
      { id: 'vegetable', name: 'Vegetable', delta: 0.00 },
      { id: 'fried-egg', name: 'Fried Egg', delta: 1.00 },
      { id: 'batter-chicken', name: 'Battered Chicken', delta: 1.00 }
    ];

    // ---------- State ----------
    let basket = []; // { name, itemId, mods:[{id,name,delta}], unitPrice, qty, img, spice }
	window.basket = basket;  // expose the array reference to the second script
    const ITEMS_BY_ID = new Map();
	
	// remove chilli emojis that are baked into menu item names
		const CHILLI_RE = /üå∂Ô∏è+/g;
		function nameWithoutChillies(str) {
		  return (str || '')
			.replace(CHILLI_RE, '')
			.replace(/\s{2,}/g, ' ')
			.trim();
		}



    // ---------- Helpers ----------
    function formatCurrency(n){ const cents = Math.round((n + Number.EPSILON) * 100); return '¬£' + (cents/100).toFixed(2); }
    function roundToTwo(n){ return Math.round((n + Number.EPSILON) * 100) / 100; }
    function chilliIcons(n){ return 'üå∂Ô∏è'.repeat(Math.max(0, Math.min(3, n||0))); }
	
	
	
	// ---- Sticky header offset (single source of truth) ----
	function computeHeaderOffset(){
  const h = document.querySelector('.site-header') || document.querySelector('header');
  return (h ? Math.round(h.getBoundingClientRect().height) : 0) + 12;
	}

	function applyHeaderOffset(){
	  document.documentElement.style.setProperty('--header-offset', computeHeaderOffset() + 'px');
	}
	window.addEventListener('load', applyHeaderOffset, { passive:true });
	window.addEventListener('resize', applyHeaderOffset, { passive:true });
	window.addEventListener('orientationchange', applyHeaderOffset, { passive:true });
	applyHeaderOffset();

	// robust smooth scroll that clamps to page bounds (prevents ‚Äúfooter snaps‚Äù)
	function smoothScrollToElTop(el){
	  if (!el) return;
	  const offset = computeHeaderOffset();
	  const target = el.getBoundingClientRect().top + window.scrollY - offset;
	  const maxTop = Math.max(0, document.documentElement.scrollHeight - window.innerHeight);
	  const top = Math.max(0, Math.min(target, maxTop));

	  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
	  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
	  window.scrollTo({ top, behavior: (isIOS || prefersReduced) ? 'auto' : 'smooth' });
	}
	
	// ---- Holiday / fully-booked ticker ----
		const tickerEl = document.getElementById('status-ticker');
		const tickerText = document.getElementById('ticker-text');

		// Simple config object (edit this anytime)
		const siteStatus = {
		  active: true,  // turn off when not needed
		  message: "We‚Äôre not open yet as we're making final equipment and ingredient preparations to ensure you have an amazing at home Thai dining experience! We hope to open by 3rd December üéâ"
		};

		if (siteStatus.active && tickerEl && tickerText) {
		  tickerText.textContent = siteStatus.message;
		  tickerEl.classList.remove('hidden');
		}

		(function adjustForTicker(){
		  const bar = document.getElementById('status-ticker');
		  if (!bar) return;
		  const set = () => {
			const h = bar.offsetHeight || 0;
			document.documentElement.style.setProperty('--ticker-height', h + 'px');
		  };
		  new ResizeObserver(set).observe(bar);
		  window.addEventListener('load', set, { passive:true });
		  window.addEventListener('resize', set, { passive:true });
		  set();
		})();



    // ---------- Build menu (accordion categories) ----------
    function buildMenu(){
      const container = document.getElementById('menu-list');
      container.innerHTML = '';

      MENU_CATEGORIES.forEach(cat => {
        const catEl = document.createElement('div'); catEl.className = 'category';
        const header = document.createElement('div'); header.className = 'category-header';
        header.innerHTML = `<h3>${cat.title}</h3><div class="caret">‚ñ∂</div>`;
        const body = document.createElement('div'); body.className = 'category-body';
		

        cat.items.forEach(item => {
          ITEMS_BY_ID.set(item.id, item);

          const el = document.createElement('div'); el.className = 'menu-item';
          el.dataset.id = item.id;
          el.dataset.price = item.price;
          if (item.allowedModifiers) el.dataset.allowedModifiers = item.allowedModifiers.join(',');
          if (item.modifierRequired) el.dataset.modifierRequired = 'true';
          if (item.modifiersMulti) el.dataset.modifiersMulti = 'true';
          if (item.modifierMax) el.dataset.modifierMax = String(item.modifierMax);
          if (item.img) el.dataset.img = item.img;
          if (item.spiceEnabled) el.dataset.spiceEnabled = 'true';
          if (typeof item.spiceDefault === 'number') el.dataset.spiceDefault = String(item.spiceDefault);

          const allergenHTML = renderAllergenIconsCompact(item.allergens || []);

          el.innerHTML = `
            <div class="meta">
              <div class="title">${item.name}</div>
              <div class="muted small">${item.desc || ''}</div>
              ${allergenHTML}
            </div>
            <div style="text-align:right">
              <div class="price">${formatCurrency(item.price)}</div>
              <div style="margin-top:8px">
                <button class="btn btn-accent" data-id="${item.id}">customise</button>
              </div>
            </div>
          `;
          body.appendChild(el);
        });
		
		
		// Accordion behavior (REPLACE your existing header.addEventListener handler with this)
// Accordion behavior (REPLACE your existing handler with this)
header.addEventListener('click', () => {
  const opening = !body.classList.contains('open');

  // 1) Close all other categories
  document.querySelectorAll('.category-body.open').forEach(b => {
    if (b !== body) {
      b.classList.remove('open');
      b.style.maxHeight = '0px';
      const ct = b.previousElementSibling?.querySelector('.caret');
      if (ct) ct.textContent = '‚ñ∂';
    }
  });

  // 2) If we‚Äôre collapsing this one, do it and stop
  if (!opening) {
    body.classList.remove('open');
    body.style.maxHeight = '0px';
    const ct = header.querySelector('.caret'); if (ct) ct.textContent = '‚ñ∂';
    return;
  }

  // 3) Open this category and set max-height for the transition
  body.classList.add('open');
  body.style.maxHeight = body.scrollHeight + 'px';
  const ct = header.querySelector('.caret'); if (ct) ct.textContent = '‚ñº';

  // --- Sticky-header-aware scroll with double correction ---
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const behavior = (isIOS || prefersReduced) ? 'auto' : 'smooth';

  // Helper to compute safe top position
  const getOffsetTop = el => {
    const h = document.querySelector('.site-header') || document.querySelector('header');
    const headerH = (h ? Math.round(h.getBoundingClientRect().height) : 0) + 12; // breathing room
    const target = el.getBoundingClientRect().top + window.pageYOffset - headerH;
    const maxTop = Math.max(0, document.documentElement.scrollHeight - window.innerHeight);
    return Math.max(0, Math.min(target, maxTop));
  };

  // Phase 1: after layout applies, scroll to the header of the category
  requestAnimationFrame(() => {
    // Force reflow so Safari registers the new height before we scroll
    void body.offsetHeight;

    window.scrollTo({ top: getOffsetTop(header), behavior });

    // Phase 2: after the CSS transition (~280ms), correct the position again
    // If you changed the transition duration in CSS, adjust 300 accordingly.
    setTimeout(() => {
      window.scrollTo({ top: getOffsetTop(header), behavior: 'auto' });
    }, 300);
  });
});


		// keep these AFTER the handler
		catEl.appendChild(header);
		catEl.appendChild(body);
		container.appendChild(catEl);

      });
    }

    // ---------- Order rendering ----------
			function renderOrder(){
		  const orderListEl  = document.getElementById('order-list');
		  const orderTotalEl = document.getElementById('order-total');

		  orderListEl.innerHTML = '';

		  if (basket.length === 0){
			orderListEl.innerHTML = '<div class="muted small">No items yet ‚Äî add something from the menu.</div>';
			orderTotalEl.textContent = formatCurrency(0);
			return;
		  }

		  basket.forEach((row, idx) => {
			const r = document.createElement('div');
			r.className = 'order-row';

			const leftWrap = document.createElement('div');
			leftWrap.style.display = 'flex';
			leftWrap.style.alignItems = 'center';
			leftWrap.style.gap = '10px';

			const img = document.createElement('img');
			img.className = 'item-thumb';
			img.alt = row.name;
			img.loading = 'lazy';
			img.src = (row.img && row.img.trim())
			  ? row.img
			  : 'data:image/svg+xml;utf8,' + encodeURIComponent(
				`<svg xmlns="http://www.w3.org/2000/svg" width="120" height="120">
				   <rect width="100%" height="100%" fill="#f1f1f1"/>
				   <text x="50%" y="50%" text-anchor="middle" dominant-baseline="middle"
						 font-family="sans-serif" font-size="12" fill="#999">No image</text>
				 </svg>`
			  );

			// ‚úÖ HERE: use clean name (no built-in chillies)
			const cleanName = nameWithoutChillies(row.name);

			const details = [];
			if (row.mods && row.mods.length) {
			  details.push(row.mods.map(m => m.name).join(', '));
			}
			if (typeof row.spice === 'number') {
			  details.push(chilliIcons(row.spice));
			}

			const text = document.createElement('div');
			text.innerHTML = `
			  <div style="font-weight:700">
				${cleanName}
				${details.length ? ` <span class="muted small">‚Ä¢ ${details.join(' ‚Ä¢ ')}</span>` : ''}
			  </div>
			  <div class="muted small">Unit: ${formatCurrency(row.unitPrice)}</div>
			`;

			const right = document.createElement('div');
			right.style.textAlign = 'right';
			right.innerHTML = `
			  <div style="font-weight:800">${formatCurrency(roundToTwo(row.unitPrice * row.qty))}</div>
			  <div style="margin-top:8px;display:flex;gap:8px;align-items:center;justify-content:flex-end">
				<button class="btn btn-ghost" data-action="dec" data-idx="${idx}">-</button>
				<div class="muted">${row.qty}</div>
				<button class="btn btn-ghost" data-action="inc" data-idx="${idx}">+</button>
				<button class="btn" style="background:transparent;color:#b02a2a;border:none;padding:6px 8px" data-action="remove" data-idx="${idx}">Remove</button>
			  </div>
			`;

			leftWrap.appendChild(img);
			leftWrap.appendChild(text);
			r.appendChild(leftWrap);
			r.appendChild(right);
			orderListEl.appendChild(r);
		  });

		  const total = basket.reduce((s, i) => s + i.unitPrice * i.qty, 0);
		  orderTotalEl.textContent = formatCurrency(roundToTwo(total));
		}


    // ---------- Modal (customise) ----------
    const modal = document.getElementById('modal');
    const modalTitle = document.getElementById('modal-title');
    const modalBase = document.getElementById('modal-base');
    const qtyInput = document.getElementById('qty-input');
    const qtyIncr = document.getElementById('qty-incr');
    const qtyDecr = document.getElementById('qty-decr');
    const modsEl = document.getElementById('mods');
    const unitPriceEl = document.getElementById('unit-price');
    const modalClose = document.getElementById('modal-close');
    const modalCancel = document.getElementById('modal-cancel');
    const modalAdd = document.getElementById('modal-add');
    const modalImg = document.getElementById('modal-img');
    const modRequiredNote = document.getElementById('mod-required-note');
    const modLimitNote = document.getElementById('mod-limit-note');
    const modalAllWrap = document.getElementById('modal-allergens-wrap');
    const modalAll = document.getElementById('modal-allergens');
    const spiceWrap = document.getElementById('spice-wrap');
    const spiceButtons = document.getElementById('spice-buttons');

    let currentItem = null;
    let selectedMods = new Set();
    let currentAllowedMods = null;
    let currentRequires = false;
    let currentMulti = false;
    let currentMax = null;
    let currentSpice = null; // 0..3 or null

    function buildModifierChips(allowed, required=false, multi=false, max=null){
      modsEl.innerHTML = '';
      selectedMods.clear();
      currentAllowedMods = Array.isArray(allowed) && allowed.length ? allowed.slice() : null;
      currentRequires = !!required;
      currentMulti = !!multi || (typeof max === 'number' && max > 0);
      currentMax = (typeof max === 'number' && max > 0) ? max : null;

      if(currentRequires && currentAllowedMods){ modRequiredNote.style.display = 'block'; modalAdd.disabled = true; }
      else { modRequiredNote.style.display = 'none'; modalAdd.disabled = false; }

      if(currentMulti && currentMax){ modLimitNote.style.display = 'block'; modLimitNote.textContent = `Choose up to ${currentMax} options`; }
      else { modLimitNote.style.display = 'none'; }

      if(!currentAllowedMods){ modsEl.style.display = 'none'; return; }
      modsEl.style.display = 'flex';

      MODIFIERS.forEach(m => {
        if(!currentAllowedMods.includes(m.id)) return;
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'chip';
        btn.innerHTML = `${m.name}${m.delta ? ` (+${formatCurrency(m.delta)})` : ''}`;
        btn.dataset.id = m.id;

        btn.addEventListener('click', () => {
          if(currentMulti){
            if(selectedMods.has(m.id)){
              selectedMods.delete(m.id);
              btn.classList.remove('selected');
            } else {
              if(currentMax && selectedMods.size >= currentMax){
                btn.animate([{transform:'translateY(-2px)'},{transform:'translateY(0)'}],{duration:140});
                return;
              }
              selectedMods.add(m.id);
              btn.classList.add('selected');
            }
            if(currentRequires) modalAdd.disabled = (selectedMods.size === 0);
            if(currentMax && currentMulti){ modLimitNote.textContent = `Selected ${selectedMods.size}/${currentMax}`; }
          } else {
            if(selectedMods.has(m.id)){
              selectedMods.delete(m.id);
              btn.classList.remove('selected');
            } else {
              selectedMods.clear();
              modsEl.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
              selectedMods.add(m.id);
              btn.classList.add('selected');
            }
            if(currentRequires) modalAdd.disabled = (selectedMods.size === 0);
          }
          updateUnitPricePreview();
        });

        modsEl.appendChild(btn);
      });
    }
	
	// ---------- Success popup (matches #order-success in HTML) ----------
	const orderSuccess      = document.getElementById('order-success');
	const orderSuccessX     = document.getElementById('order-success-x');
	const orderSuccessClose = document.getElementById('order-success-close');

	function showOrderSuccess({ ref, subtotal, delivery, total, orderType }, items, preferredTimeStr) {
	  if (!orderSuccess) {
		// fallback
		alert(`Order placed! ${ref}`);
		return;
	  }

	  // 1) header
	  const titleEl = document.getElementById('order-success-title');
	  if (titleEl) {
		// ‚¨ÖÔ∏è use ref AS-IS, do NOT add "RTK-" again
		titleEl.textContent = `Order confirmed ‚Äî ${ref}`;
	  }

	  // 2) message
	  const msgEl = document.getElementById('order-success-msg');
	  if (msgEl) {
		const suffix = orderType === 'delivery' ? 'delivery' : 'collection';
		const note = preferredTimeStr
		  ? `Thanks! We‚Äôll contact you to confirm your ${suffix} time (${preferredTimeStr}).`
		  : `Thanks! We‚Äôll contact you to confirm your ${suffix}.`;
		msgEl.textContent = note;
	  }

	  // 3) items
	  const listEl = document.getElementById('order-success-items');
	  if (listEl) {
		listEl.innerHTML = '';
		items.forEach(row => {
		  const details = [];
		  if (row.mods?.length) details.push(row.mods.map(m => m.name).join(', '));
		  if (typeof row.spice === 'number') details.push('üå∂Ô∏è'.repeat(row.spice));

		  const div = document.createElement('div');
		  div.style.padding = '6px 0';
		  div.style.borderBottom = '1px dashed #eee';
		  div.innerHTML = `
			${row.qty} √ó ${row.name}
			${details.length ? ` <span class="muted small">‚Ä¢ ${details.join(' ‚Ä¢ ')}</span>` : ''}
		  `;
		  listEl.appendChild(div);
		});
	  }

	  // 4) total
	  const totalEl = document.getElementById('order-success-total');
	  if (totalEl) {
		totalEl.textContent = formatCurrency(total);
	  }

	  orderSuccess.style.display = 'flex';
	}

	// close buttons
	if (orderSuccessX)     orderSuccessX.addEventListener('click', () => orderSuccess.style.display = 'none');
	if (orderSuccessClose) orderSuccessClose.addEventListener('click', () => orderSuccess.style.display = 'none');
	if (orderSuccess) {
	  orderSuccess.addEventListener('click', (e) => {
		if (e.target === orderSuccess) orderSuccess.style.display = 'none';
	  });
	}


	// make it available to the second script
	window.showOrderSuccess = showOrderSuccess;

	
		// ----  (pure front-end) ----

	(function(){
	  const wrap  = document.getElementById('order-success');
	  const title = document.getElementById('order-success-title');
	  const msg   = document.getElementById('order-success-msg');
	  const list  = document.getElementById('order-success-items');
	  const totalEl = document.getElementById('order-success-total');
	  const btnClose = document.getElementById('order-success-close');
	  const btnX     = document.getElementById('order-success-x');

	  function hide() {
		if (wrap) wrap.style.display = 'none';
	  }

	  // expose a global helper we can call later (kept for backwards compatibility)
	function showOrderSuccess(orderId, items, total, orderType, preferredTime) {
	  // If the new-style function exists, delegate to it
	  if (typeof window.showOrderSuccessNew === 'function') {
		window.showOrderSuccessNew(
		  {
			// if checkout already passed "RTK-012", keep it;
			// if it passed just "012", add RTK-
			ref: (typeof orderId === 'string' && orderId.startsWith('RTK-'))
			  ? orderId
			  : `RTK-${orderId}`,
			subtotal: 0,
			delivery: 0,
			total: total || 0,
			orderType: orderType || 'collection'
		  },
		  items || [],
		  preferredTime || null
		);
		return;
	  }
	  

	  // Fallback if the new function isn‚Äôt there
	  alert(
		(typeof orderId === 'string' ? orderId : `RTK-${orderId}`) ||
		'Order placed!'
	  );
	}


	  if (btnClose) btnClose.addEventListener('click', hide);
	  if (btnX)     btnX.addEventListener('click', hide);
	  if (wrap)     wrap.addEventListener('click', e => {
		if (e.target === wrap) hide();
	  });

	  // make available to other scripts
	  window.showOrderSuccess = showOrderSuccess;
	})();


    function buildSpiceSelector(enabled, defaultLevel=0){
      if(!enabled){
        spiceWrap.style.display = 'none';
        spiceButtons.innerHTML = '';
        currentSpice = null;
        return;
      }
      spiceWrap.style.display = 'block';
      spiceButtons.innerHTML = '';
      currentSpice = Math.max(0, Math.min(3, Number(defaultLevel)||0));

      const labels = [
        {v:0, text:'No spice'},
        {v:1, text:'Mild üå∂Ô∏è'},
        {v:2, text:'Medium üå∂Ô∏èüå∂Ô∏è'},
        {v:3, text:'Very spicy üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è'}
      ];
      labels.forEach(l=>{
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'spice-btn' + (l.v===currentSpice ? ' active':'');
        b.textContent = l.text;
        b.setAttribute('aria-pressed', l.v===currentSpice ? 'true':'false');
        b.addEventListener('click', ()=>{
          currentSpice = l.v;
          [...spiceButtons.querySelectorAll('.spice-btn')].forEach(x=>{
            x.classList.remove('active'); x.setAttribute('aria-pressed','false');
          });
          b.classList.add('active'); b.setAttribute('aria-pressed','true');
        });
        spiceButtons.appendChild(b);
      });
    }

    function closeModal(){
      modal.style.display = 'none';
      currentItem = null;
      selectedMods.clear();
      currentAllowedMods = null;
      if (modalImg){ modalImg.removeAttribute('src'); modalImg.style.display = 'none'; }
      buildSpiceSelector(false);
    }

    function updateUnitPricePreview(){
      if(!currentItem) return;
      const base = Number(modalBase.dataset.price) || 0;
      let modsTotal = 0;
      selectedMods.forEach(id => {
        if(!currentAllowedMods || !currentAllowedMods.includes(id)) return;
        const m = MODIFIERS.find(x => x.id === id);
        if(m){ modsTotal += m.delta; }
      });
      const unit = roundToTwo(base + modsTotal);
      unitPriceEl.textContent = formatCurrency(unit);
    }

    function opencustomise(itemId){
      const found = ITEMS_BY_ID.get(itemId);
      if(!found) return;
      currentItem = found;

      const allowed = Array.isArray(found.allowedModifiers) ? found.allowedModifiers : null;
      const requiresModifier = !!found.modifierRequired;
      const isMulti = !!found.modifierMax || !!found.modifiersMulti;
      const max = (typeof found.modifierMax === 'number' && found.modifierMax > 0) ? found.modifierMax : null;

      buildModifierChips(allowed, requiresModifier, isMulti, max);

      modalTitle.textContent = `customise ‚Äî ${found.name}`;
      modalBase.dataset.price = found.price;
      modalBase.textContent = `Base price: ${formatCurrency(found.price)}`;
      qtyInput.value = 1;
      updateUnitPricePreview();

      if (modalImg) {
        if (found.img) { modalImg.src = found.img; modalImg.style.display = 'block'; }
        else { modalImg.removeAttribute('src'); modalImg.style.display = 'none'; }
      }

      if (found.allergens && found.allergens.length) {
        modalAll.innerHTML = renderAllergenBadges(found.allergens);
        modalAllWrap.style.display = 'block';
      } else {
        modalAll.innerHTML = '';
        modalAllWrap.style.display = 'none';
      }

      buildSpiceSelector(!!found.spiceEnabled, typeof found.spiceDefault==='number'?found.spiceDefault:0);

      modal.style.display = 'flex';
    }

    document.getElementById('qty-incr').addEventListener('click', ()=>{ qtyInput.value = Math.max(1, parseInt(qtyInput.value || '1') + 1); });
    document.getElementById('qty-decr').addEventListener('click', ()=>{ qtyInput.value = Math.max(1, parseInt(qtyInput.value || '1') - 1); });

    document.getElementById('modal-close').addEventListener('click', closeModal);
    document.getElementById('modal-cancel').addEventListener('click', closeModal);
    modal.addEventListener('click', (ev) => { if(ev.target === modal) closeModal(); });

    document.getElementById('modal-add').addEventListener('click', ()=>{
      if(!currentItem) return;

      if(currentItem.modifierRequired && selectedMods.size === 0){
        modRequiredNote.style.display = 'block';
        modsEl.scrollIntoView({behavior:'smooth', block:'center'});
        return;
      }
      if(currentMulti && currentMax && selectedMods.size > currentMax){ return; }

      const base = Number(modalBase.dataset.price) || 0;
      const modsArr = []; let modsTotal = 0;
      selectedMods.forEach(id => {
        if(!currentAllowedMods || !currentAllowedMods.includes(id)) return;
        const m = MODIFIERS.find(x => x.id === id);
        if(m){ modsTotal += m.delta; modsArr.push(m); }
      });
      const unitPrice = roundToTwo(base + modsTotal);
      const qty = Math.max(1, parseInt(qtyInput.value || '1'));

      basket.push({
        name: currentItem.name,
        itemId: currentItem.id,
        mods: modsArr,
        unitPrice,
        qty,
        img: currentItem.img || '',
        spice: currentSpice // 0..3 or null
      });
      closeModal();
      renderOrder();
    });

    document.getElementById('menu-list').addEventListener('click', e => {
      const btn = e.target.closest('button');
      if(!btn || !btn.dataset.id) return;
      opencustomise(btn.dataset.id);
    });
    document.getElementById('order-panel').addEventListener('click', e => {
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.dataset.action;
      const idx = Number(btn.dataset.idx);
      if(action === 'inc'){ basket[idx].qty += 1; renderOrder(); }
      if(action === 'dec'){ basket[idx].qty = Math.max(1, basket[idx].qty - 1); renderOrder(); }
      if(action === 'remove'){ basket.splice(idx, 1); renderOrder(); }
    });

    // Lightbox
    document.querySelectorAll('#food-grid img').forEach(img => {
      img.addEventListener('click', ()=> {
        const lb = document.getElementById('lightbox');
        const lbImg = document.getElementById('lightbox-img');
        lbImg.src = img.src || '';
        lb.style.display = 'flex';
      });
    });
    document.getElementById('lightbox').addEventListener('click', (e) => {
      if(e.target.id === 'lightbox' || e.target.id === 'lightbox-img') e.currentTarget.style.display = 'none';
    });

    document.addEventListener('keydown', (e) => {
      if(e.key === 'Escape' && modal.style.display === 'flex') closeModal();
      if(e.key === 'Escape' && checkoutModal.style.display === 'flex') closeCheckout();
      if(e.key === 'Escape' && successModal.style.display === 'flex') hideOrderSuccess();
    });

    // Build & first render
    buildMenu();
    renderOrder();
	// expose helpers that the second script uses
	window.formatCurrency = formatCurrency;
	/*window.openCheckout = openCheckout;*/
	window.orderMsg = document.getElementById('order-msg');
	window.basket = basket;
	window.renderOrder = renderOrder;
	window.roundToTwo = roundToTwo;
	window.chilliIcons = chilliIcons;
	window.nameWithoutChillies = nameWithoutChillies;
	

	}); // end DOMContentLoaded
</script>

	<script>
	  if (typeof window.formatCurrency !== 'function') {
		window.formatCurrency = n => '¬£' + Number(n || 0).toFixed(2);
	  }
	  if (typeof window.roundToTwo !== 'function') {
		window.roundToTwo = n => Math.round((n || 0) * 100) / 100;
	  }
	</script>
	
	<script>
	  // hard-sanitize anything we send to the PDF
	  function pdfSafe(str) {
		return (str || '')
		  // remove chilli emoji (both with vs16 and plain)
		  .replace(/üå∂Ô∏è/gu, '')
		  .replace(/üå∂/g, '')
		  // remove any emoji / symbols in the big emoji planes
		  .replace(/[\u{1F000}-\u{1FFFF}]/gu, '')
		  // finally, strip anything not basic ASCII
		  .replace(/[^\x20-\x7E]/g, '')
		  .trim();
	  }
</script>

	<!-- jsPDF (must be before our downloadReceipt) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>



  <!-- Supabase JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // Init Supabase
    const SUPABASE_URL = 'https://ubyjrrsvbbqomitpaidb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVieWpycnN2YmJxb21pdHBhaWRiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA5NTYyNjMsImV4cCI6MjA3NjUzMjI2M30.WTllxO5KnaMI0i1d4VHNBhjLuRMfu4_Xx5arqZmYevw';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
	

/* ------------------------------
   Blackout windows (from Supabase)
---------------------------------*/

// In-memory windows (filled by Supabase)
let CLOSED_RANGES = [];      // [{start:Date, end:Date, message?:string}]
let FULLY_BOOKED  = [];      // same shape

// Load active windows that intersect ‚Äúnow ‚Üí +60 days‚Äù (tweak as needed)
async function loadBlackouts() {
  const now = new Date();
  const horizon = new Date();
  horizon.setDate(horizon.getDate() + 60);

  const { data, error } = await supabase
    .from('booking_blackouts')
    .select('kind,start_at,end_at,message,active')
    .eq('active', true)
    // overlap test (start < horizon && end > now)
    .lt('start_at', horizon.toISOString())
    .gt('end_at',  now.toISOString());

  if (error) {
    console.warn('[blackouts] fetch failed', error);
    return;
  }

  CLOSED_RANGES = [];
  FULLY_BOOKED  = [];

  (data || []).forEach(row => {
    const win = {
      start: new Date(row.start_at),
      end:   new Date(row.end_at),
      message: row.message || ''
    };
    if (row.kind === 'closed')       CLOSED_RANGES.push(win);
    if (row.kind === 'fully_booked') FULLY_BOOKED.push(win);
  });
}

// Helpers
function inAnyWindow(dt, windows) {
  const t = +dt;
  return windows.find(w => t >= +w.start && t <= +w.end) || null;
}

// Banner helpers
function showCheckoutBanner(kind, msg) {
  const el = document.getElementById('checkout-banner');
  if (!el) return;
  el.className = 'checkout-banner ' + (kind === 'closed'
    ? 'checkout-banner--closed'
    : 'checkout-banner--fullybooked');

  el.innerHTML = `
    <button class="x" aria-label="Dismiss" onclick="this.parentElement.style.display='none'">√ó</button>
    ${msg}
  `;
  el.style.display = 'block';
}
function hideCheckoutBanner() {
  const el = document.getElementById('checkout-banner');
  if (el) { el.style.display = 'none'; el.textContent = ''; el.className = 'checkout-banner'; }
}

// === Customer helper: find-or-create with phone/email uniqueness ===
async function getOrCreateCustomer({ name, email, phone, address }) {
  const normEmail = email ? email.trim().toLowerCase() : null;
  const normPhone = phone ? phone.trim() : null;

  if (normEmail) {
    // A) by email
    const { data: existingByEmail, error: findEmailErr } = await supabase
      .from('customers')
      .select('id, phone')
      .eq('email', normEmail)
      .maybeSingle();
    if (findEmailErr) throw findEmailErr;

    if (existingByEmail) {
      const updatePayload = { full_name: name, address };
      if (!existingByEmail.phone && normPhone) updatePayload.phone = normPhone;

      const { data: updated, error: updErr } = await supabase
        .from('customers')
        .update(updatePayload)
        .eq('id', existingByEmail.id)
        .select('id')
        .single();
      if (updErr) throw updErr;
      return updated;
    }

    // No email row yet ‚Üí try insert (may collide on phone)
    const baseInsert = { full_name: name, email: normEmail, address };
    if (normPhone) baseInsert.phone = normPhone;

    let { data: inserted, error: insErr } = await supabase
      .from('customers')
      .insert([baseInsert])
      .select('id')
      .single();

    if (insErr && insErr.code === '23505') {
      // duplicate phone ‚Üí retry without phone
      const { data: inserted2, error: insErr2 } = await supabase
        .from('customers')
        .insert([{ full_name: name, email: normEmail, address }])
        .select('id')
        .single();
      if (insErr2) throw insErr2;
      return inserted2;
    }
    if (insErr) throw insErr;
    return inserted;
  }

  if (normPhone) {
    // B) no email ‚Üí by phone
    const { data: existingByPhone, error: findPhoneErr } = await supabase
      .from('customers')
      .select('id')
      .eq('phone', normPhone)
      .maybeSingle();
    if (findPhoneErr) throw findPhoneErr;

    if (existingByPhone) {
      const { data: updated, error: updErr } = await supabase
        .from('customers')
        .update({ full_name: name, address })
        .eq('id', existingByPhone.id)
        .select('id')
        .single();
      if (updErr) throw updErr;
      return updated;
    }

    const { data: inserted, error: insErr } = await supabase
      .from('customers')
      .insert([{ full_name: name, phone: normPhone, address }])
      .select('id')
      .single();
    if (insErr) throw insErr;
    return inserted;
  }

  // C) bare minimum
  const { data: bare, error: bareErr } = await supabase
    .from('customers')
    .insert([{ full_name: name, address }])
    .select('id')
    .single();
  if (bareErr) throw bareErr;
  return bare;
}


/* ------------------------------
   Wire into your existing flow
---------------------------------*/

// 1) Load blackouts early (don‚Äôt block UI)
loadBlackouts();

// 2) When opening checkout, keep your existing min (+30m) and step=300
//    Just add an input change listener to live-validate the chosen time.
const preferredTimeInput = document.getElementById('cust-preferred-time');
if (preferredTimeInput) {
  preferredTimeInput.addEventListener('change', () => {
    hideCheckoutBanner();
    const raw = preferredTimeInput.value; // 'YYYY-MM-DDTHH:mm'
    if (!raw) return;

    const chosen = new Date(raw);
    const isClosed = inAnyWindow(chosen, CLOSED_RANGES);
    const isFull   = inAnyWindow(chosen, FULLY_BOOKED);

    const submitBtn = document.getElementById('checkout-submit');
    if (isClosed) {
      showCheckoutBanner('closed', isClosed.message || 'We‚Äôre closed at the selected time.');
      if (submitBtn) submitBtn.disabled = true;
      return;
    }
    if (isFull) {
      showCheckoutBanner('fully_booked', isFull.message || 'We‚Äôre fully booked at the selected time.');
      if (submitBtn) submitBtn.disabled = true;
      return;
    }
    if (submitBtn) submitBtn.disabled = false;
  });
}

// 3) Guard your submit handler (fail fast if invalid)
//    In your existing `checkoutForm.addEventListener('submit', async (e) => { ... })`,
//    add these lines near the top, right after you read `preferredTimeRaw`:

/*
  // inside your submit handler, after:
  // const preferredTimeRaw = document.getElementById('cust-preferred-time').value;
  hideCheckoutBanner();
  const chosenDt = preferredTimeRaw ? new Date(preferredTimeRaw) : null;
  const isClosedNow = chosenDt && inAnyWindow(chosenDt, CLOSED_RANGES);
  const isFullNow   = chosenDt && inAnyWindow(chosenDt, FULLY_BOOKED);

  if (isClosedNow) {
    showCheckoutBanner('closed', isClosedNow.message || 'We‚Äôre closed at the selected time.');
    return; // stop submit
  }
  if (isFullNow) {
    showCheckoutBanner('fully_booked', isFullNow.message || 'We‚Äôre fully booked at the selected time.');
    return; // stop submit
  }
*/



    // Checkout modal helpers
    const checkoutModal = document.getElementById('checkout-modal');
    const checkoutClose = document.getElementById('checkout-close');
    const checkoutCancel = document.getElementById('checkout-cancel');
    const checkoutForm = document.getElementById('checkout-form');
    const checkoutMsg = document.getElementById('checkout-msg');
    const checkoutSubtotalEl = document.getElementById('checkout-subtotal');
    const checkoutDeliveryEl = document.getElementById('checkout-delivery');
    const checkoutTotalEl = document.getElementById('checkout-total');
    const deliveryNote = document.getElementById('delivery-note');
    const orderMsg = document.getElementById('order-msg');
    const openCheckoutBtn = document.getElementById('open-checkout');

    const orderTypeRadios = document.querySelectorAll('input[name="order-type"]');
    let checkoutBaseSubtotal = 0;

    function calcDeliveryFee(subtotal, orderType){
      if(orderType !== 'delivery') return 0;
      return subtotal < 20 ? 3 : 0;
    }
    function recomputeCheckoutTotals(){
      const orderType = document.querySelector('input[name="order-type"]:checked')?.value || 'collection';
      const fee = calcDeliveryFee(checkoutBaseSubtotal, orderType);
      const total = checkoutBaseSubtotal + fee;
      deliveryNote.style.display = (orderType === 'delivery') ? 'block' : 'none';
      checkoutSubtotalEl.textContent = formatCurrency(checkoutBaseSubtotal);
      checkoutDeliveryEl.textContent = formatCurrency(fee);
      checkoutTotalEl.textContent = formatCurrency(total);
    }
    orderTypeRadios.forEach(r => r.addEventListener('change', recomputeCheckoutTotals));
	
	// ---- Address required only for delivery ----
	function updateAddressRequirement() {
	  const orderType = document.querySelector('input[name="order-type"]:checked')?.value || 'collection';
	  const addr = document.getElementById('cust-address');
	  const hint = document.getElementById('addr-required-hint');

	  const isDelivery = (orderType === 'delivery');

	  if (addr) {
		// Toggle HTML5 required attribute
		addr.required = isDelivery;

		// Optional: visual cue
		if (hint) hint.style.opacity = isDelivery ? '1' : '0.6';

		// Optional: show/hide the whole field for collection
		// (comment out if you prefer to always show it)
		// addr.closest('.field').style.display = isDelivery ? '' : '';
	  }
	}

	// run when radios change
	orderTypeRadios.forEach(r => r.addEventListener('change', () => {
	  recomputeCheckoutTotals();        // you already have this
	  updateAddressRequirement();       // add this
	}));

	
// ====== CONFIG YOU CAN EDIT ======
const OPEN_DAYS = [0,3,4,5,6]; // Sun=0, Mon=1, Tue=2, Wed=3, Thu=4, Fri=5, Sat=6  (open Wed‚ÄìSun)
const OPEN_WINDOW = { start: "17:00", end: "21:00" }; // local time, 24h

// Specific closed dates (all day)
const CLOSED_DATES = [
 "2025-12-25", "2025-12-26"
];

// Closed ranges (start/end local)
//const CLOSED_RANGES = [
  // { start:"2025-11-08T00:00", end:"2025-11-11T23:59" }
//];

// Fully booked windows by date: { "YYYY-MM-DD": [ ["HH:MM","HH:MM"], ... ] }
//const FULLY_BOOKED = {
  // "2025-11-05": [["17:00","18:30"], ["20:00","21:00"]]
//};

// ====== HELPERS ======
function toYMD(d){
  const pad = n => String(n).padStart(2,'0');
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`;
}
function parseHm(dateRef, hm){ // "HH:MM" -> Date on same Y/M/D
  const [h,m] = hm.split(':').map(Number);
  const d = new Date(dateRef);
  d.setHours(h, m, 0, 0);
  return d;
}
function isBetween(d, start, end){ return d >= start && d <= end; }
function roundTo5Min(d){
  const ms = 5 * 60 * 1000;
  return new Date(Math.ceil(d.getTime() / ms) * ms);
}
function withinOpenHours(d){
  // day
  if (!OPEN_DAYS.includes(d.getDay())) return false;
  // time
  const start = parseHm(d, OPEN_WINDOW.start);
  const end   = parseHm(d, OPEN_WINDOW.end);
  return d >= start && d <= end;
}
function isClosedDate(d){
  const ymd = toYMD(d);
  if (CLOSED_DATES.includes(ymd)) return true;
  for (const r of CLOSED_RANGES){
    const rs = new Date(r.start);
    const re = new Date(r.end);
    if (isBetween(d, rs, re)) return true;
  }
  return false;
}
function isFullyBooked(d){
  const ymd = toYMD(d);
  const slots = FULLY_BOOKED[ymd];
  if (!slots) return false;
  return slots.some(([a,b]) => {
    const s = parseHm(d, a);
    const e = parseHm(d, b);
    return isBetween(d, s, e);
  });
}
function isAllowed(dt){
  return withinOpenHours(dt) && !isClosedDate(dt) && !isFullyBooked(dt);
}
function nextAllowed(from){
  // walk forward in 5-minute steps until we find an allowed slot (cap at +30 days)
  const cap = new Date(from); cap.setDate(cap.getDate() + 30);
  let t = new Date(from);
  t = roundTo5Min(t);
  while (t <= cap){
    if (isAllowed(t)) return t;
    t = new Date(t.getTime() + 5*60*1000);
  }
  return null;
}


	
	// run on checkout open (after you set the default radio)
	function openCheckout(subtotal){
  checkoutBaseSubtotal = Math.round(subtotal*100)/100;
  checkoutMsg.textContent = '';
  document.querySelector('input[name="order-type"][value="collection"]').checked = true;
  recomputeCheckoutTotals();

  const t = document.getElementById('cust-preferred-time');
  if (t){
    // force native 5-min increments
    t.setAttribute('step', '300');

    // compute "now + 30m" minimum, then snap to next *allowed* 5-min slot
    const now = new Date();
    now.setMinutes(now.getMinutes() + 30);
    const minCandidate = roundTo5Min(now);
    const firstAllowed = nextAllowed(minCandidate) || minCandidate;

    const pad = n => String(n).padStart(2,'0');
    const toLocalInput = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;

    // Set min and prefill the field to the first allowed slot
    t.min = toLocalInput(firstAllowed);
    t.value = toLocalInput(firstAllowed);

    // Live validation + snapping on change
    const onChoose = () => {
      if (!t.value) return;
      const chosen = new Date(t.value);
      const rounded = roundTo5Min(chosen);
      if (!isAllowed(rounded)){
        const n = nextAllowed(rounded);
        if (n){
          t.value = toLocalInput(n);
          checkoutMsg.style.color = '#b02a2a';
          checkoutMsg.textContent = 'That time is unavailable; we‚Äôve moved you to the next available slot.';
        } else {
          checkoutMsg.style.color = '#b02a2a';
          checkoutMsg.textContent = 'No available time slots found. Please choose a different day.';
        }
      } else {
        checkoutMsg.textContent = '';
      }
    };
    t.removeEventListener('change', onChoose); // avoid double-binding on repeated opens
    t.addEventListener('change', onChoose);
    t.addEventListener('input', onChoose);
  }

  checkoutModal.style.display = 'flex';
}

// make sure others can see it even if they run earlier
window.openCheckout = openCheckout;
	
// ---- Preferred Time: any date + 5-minute steps + opening hours ----
(function preferredTimeHelper(){
  // Config
  const STEP_SECONDS   = 300;  // 5 minutes
  const LEAD_MINUTES   = 30;   // prep time when picking "today"
  const OPEN_H = 17, OPEN_M = 0;    // 17:00
  const CLOSE_H = 21, CLOSE_M = 30; // 21:30

  // Utils
  const pad = n => String(n).padStart(2,'0');
  const fmt = d => `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;

  function roundUpTo5(d){
    const ms = 5 * 60 * 1000;
    return new Date(Math.ceil(d.getTime() / ms) * ms);
  }
  function sameYMD(a,b){ return a.getFullYear()===b.getFullYear() && a.getMonth()===b.getMonth() && a.getDate()===b.getDate(); }
  function windowFor(date){
    const open  = new Date(date);  open.setHours(OPEN_H,  OPEN_M,  0, 0);
    const close = new Date(date); close.setHours(CLOSE_H, CLOSE_M, 0, 0);
    return { open, close };
  }

  // Normalize a datetime-local input's value to 5m grid and within open/close
  function normalizePreferredTime(input){
    if (!input) return;

    // If user hasn't picked anything yet, keep current value or set default below.
    let val = input.value ? new Date(input.value) : new Date();

    // Build open/close window for the *selected date*
    const pickedDay = input.value ? new Date(val) : new Date();
    const { open, close } = windowFor(pickedDay);

    // If the selected date is today, enforce lead time (now + LEAD_MINUTES)
    const now = new Date();
    const minToday = roundUpTo5(new Date(now.getTime() + LEAD_MINUTES*60000));

    let proposed = roundUpTo5(val);

    if (sameYMD(open, now)) {
      // date is today
      if (proposed < minToday) proposed = minToday;
    }

    // Clamp into opening window
    if (proposed < open)  proposed = open;
    if (proposed > close) proposed = close;

    input.value = fmt(proposed);
  }

  // Public init to be called when opening checkout
  window.setPreferredTimeConstraints = function setPreferredTimeConstraints(){
    const input = document.getElementById('cust-preferred-time');
    if (!input) return;

    // Allow any date; just enforce 5-minute stepping
    input.step = STEP_SECONDS;

    // Default suggestion when modal opens:
    const now = new Date();
    const base = roundUpTo5(new Date(now.getTime() + LEAD_MINUTES*60000));
    const { open, close } = windowFor(now);

    let first = base;
    if (first < open)  first = open;
    if (first > close) first = open; // if too late today, suggest today's open; user can change date

    input.value = fmt(first);

    // Whenever user changes date/time, snap to grid & window of that day
    input.addEventListener('change', () => normalizePreferredTime(input));
    input.addEventListener('blur',   () => normalizePreferredTime(input));
  };
})();



    function openCheckout(subtotal){
	  checkoutBaseSubtotal = Math.round(subtotal*100)/100;
	  checkoutMsg.textContent = '';
	  document.querySelector('input[name="order-type"][value="collection"]').checked = true;
	  recomputeCheckoutTotals();

	  // ‚úÖ set 5-minute step and opening hours
	  setPreferredTimeConstraints();

	  checkoutModal.style.display = 'flex';
	}

			function closeCheckout(){
		  if (checkoutModal) checkoutModal.style.display = 'none';
		}

		// safe listeners
		if (checkoutClose) {
		  checkoutClose.addEventListener('click', closeCheckout);
		}
		if (checkoutCancel) {
		  checkoutCancel.addEventListener('click', closeCheckout);
		}
		if (checkoutModal) {
		  checkoutModal.addEventListener('click', (e) => {
			if (e.target === checkoutModal) closeCheckout();
		  });
		}

		// Open checkout (safe)
		if (openCheckoutBtn) {
		  openCheckoutBtn.addEventListener('click', () => {
			if (!window.basket || window.basket.length === 0) {
			  if (orderMsg) {
				orderMsg.textContent = 'Your basket is empty.';
				orderMsg.style.color = '#b02a2a';
			  }
			  return;
			}
			if (orderMsg) orderMsg.textContent = '';
			const subtotal = window.basket.reduce((s, i) => s + i.unitPrice * i.qty, 0);
			openCheckout(subtotal);
		  });
		}

	
		// ---------- Helpers to call Supabase RPC & REST ----------
    async function getNextOrderRef(){
      // Calls public.get_next_order_number() and returns "RTK-###"
      const { data, error } = await supabase.rpc('get_next_order_number');
      if (error) { console.error('get_next_order_number failed', error); throw error; }
      const assigned = Array.isArray(data) ? data[0]?.assigned : (data?.assigned ?? data);
      const num = Number(assigned || 0);
      return 'RTK-' + String(num).padStart(3,'0');
    }
	
		// --- Success popup renderer (with Download PDF) ---
		window.__lastOrderForPdf = null;
		
		// helper: strip any üå∂Ô∏è from item names so we only show user's chosen level
		function stripChillies(str) {
		  return (str || '').replace(/üå∂Ô∏è+/g, '').replace(/\s{2,}/g, ' ').trim();
		}


		window.showOrderSuccessNew = function (summary, items, preferredTimeStr) {
		  const wrap     = document.getElementById('order-success');
		  const titleEl  = document.getElementById('order-success-title');
		  const msgEl    = document.getElementById('order-success-msg');
		  const listEl   = document.getElementById('order-success-items');
		  const totalEl  = document.getElementById('order-success-total');

		  if (!wrap) {
			alert(`Order placed! ${summary?.ref || ''}`);
			return;
		  }

		  // header
		  if (titleEl) {
			titleEl.textContent = `Order confirmed ‚Äî ${summary.ref}`;
		  }

		  // note
		  if (msgEl) {
			const suffix = summary.orderType === 'delivery' ? 'delivery' : 'collection';
			const note = preferredTimeStr
			  ? `Thanks! We‚Äôll contact you to confirm your ${suffix} time (${preferredTimeStr}).`
			  : `Thanks! We‚Äôll contact you to confirm your ${suffix} time.`;
			msgEl.textContent = note;
		  }

		  // items
		  if (listEl) {
			listEl.innerHTML = items.map((row) => {
	  const cleanName = stripChillies(row.name);
	  const hasMods  = row.mods && row.mods.length;
	  const hasSpice = typeof row.spice === 'number';
	  const spiceStr = hasSpice ? ' ' + 'üå∂Ô∏è'.repeat(Math.max(0, Math.min(3, row.spice))) : '';
	  return `
		<div style="padding:6px 0;border-bottom:1px dashed #eee">
		  ${row.qty} √ó ${cleanName}
		  ${hasMods ? `<span class="muted small"> ‚Ä¢ ${row.mods.map(m => m.name).join(', ')}</span>` : ''}
		  ${spiceStr}
		  <div class="muted small">Line: ${window.formatCurrency(row.qty * row.unitPrice)}</div>
		</div>
	  `;
	}).join('');

		  }

		  // total
		  if (totalEl) {
			totalEl.textContent = window.formatCurrency(summary.total);
		  }
		  
		    // hook up the "Download receipt" button
  const dlBtn = document.getElementById('order-success-download');
  if (dlBtn) {
    dlBtn.onclick = () => {
      // make it loud so we see it even if console is filtered
      console.error('[Receipt] download clicked', items);
      if (typeof window.downloadReceipt === 'function') {
        window.downloadReceiptPlain(summary, items, preferredTimeStr);
      }
    };
  }


		  // ‚úÖ store for PDF generation
		  window.__lastOrderForPdf = { summary, items, preferredTimeStr };

		  wrap.style.display = 'flex';
		};

	async function getOrCreateCustomer({ name, email, phone, address }) {
  const payload = {
    full_name: name,
    email: email || null,
    phone: phone || null,
    address: address || null
  };

  async function tryOnce() {
    // Prefer email as the stable key if present
    if (email) {
      const { data, error } = await supabase
        .from('customers')
        .upsert([payload], { onConflict: 'email' })
        .select('id')
        .maybeSingle();

      // If unique violation fired on phone, just fetch existing row
      if (error && error.code === '23505') {
        const { data: d2 } = await supabase
          .from('customers')
          .select('id')
          .eq('email', email)
          .maybeSingle();
        return d2;
      }
      if (error) throw error;
      return data;
    }

    // Else use phone as the key
    if (phone) {
      const { data, error } = await supabase
        .from('customers')
        .upsert([payload], { onConflict: 'phone' })
        .select('id')
        .maybeSingle();

      if (error && error.code === '23505') {
        const { data: d2 } = await supabase
          .from('customers')
          .select('id')
          .eq('phone', phone)
          .maybeSingle();
        return d2;
      }
      if (error) throw error;
      return data;
    }

    // No email/phone ‚Üí insert a bare record
    const { data, error } = await supabase
      .from('customers')
      .insert([{ full_name: name, address: address || null }])
      .select('id')
      .single();
    if (error) throw error;
    return data;
  }

  try {
    return await tryOnce();
  } catch (e) {
    // brief backoff & retry once (handles flaky mobile ‚ÄúLoad failed‚Äù)
    await new Promise(r => setTimeout(r, 450));
    return await tryOnce();
  }
}

   // Submit checkout ‚Üí Supabase (with upsert customer + order_ref + preferred_time)
checkoutForm.addEventListener('submit', async (e) => {
  e.preventDefault();
  checkoutMsg.style.color = '';
  checkoutMsg.textContent = 'Placing order‚Ä¶';

  try {
    const name    = document.getElementById('cust-name').value.trim();
    const email   = document.getElementById('cust-email').value.trim();
    const phone   = document.getElementById('cust-phone').value.trim();
    const address = document.getElementById('cust-address').value.trim();
    const orderType = document.querySelector('input[name="order-type"]:checked')?.value || 'collection';
    const notes   = document.getElementById('cust-notes').value.trim() || null;

    const preferredTimeRaw = document.getElementById('cust-preferred-time').value;
    const selectedLocal    = preferredTimeRaw ? new Date(preferredTimeRaw) : null;
    const preferredTimeISO = preferredTimeRaw ? new Date(preferredTimeRaw).toISOString() : null;

    if (!name){  checkoutMsg.style.color='#b02a2a'; checkoutMsg.textContent='Please enter your full name.';  return; }
    if (!email){ checkoutMsg.style.color='#b02a2a'; checkoutMsg.textContent='Please enter your email.';      return; }
    if (!phone){ checkoutMsg.style.color='#b02a2a'; checkoutMsg.textContent='Please enter your phone number.'; return; }
    if (orderType === 'delivery' && !address){
      checkoutMsg.style.color='#b02a2a';
      checkoutMsg.textContent='Please enter your delivery address.';
      document.getElementById('cust-address').focus();
      return;
    }
    if (!selectedLocal || !isAllowed(roundTo5Min(selectedLocal))) {
      checkoutMsg.style.color = '#b02a2a';
      checkoutMsg.textContent = 'Please choose an available date/time during our opening hours.';
      return;
    }

    const itemsSnapshot = basket.map(i => ({ ...i }));
    const subtotal = itemsSnapshot.reduce((s,i)=> s + i.unitPrice * i.qty, 0);
    const deliveryFee = (orderType === 'delivery' && subtotal < 20) ? 3.00 : 0.00;

    function fail(step, err){
      console.error(`[Checkout] ${step} failed:`, err);
      checkoutMsg.style.color = '#b02a2a';
      checkoutMsg.textContent = `${step} failed: ${err?.message || err?.hint || 'Unknown error'}`;
    }

    // --- get or create the customer (with 1 retry) ---
    let customerId = null;
    try {
      const row = await getOrCreateCustomer({
        name,
        email: email?.trim().toLowerCase() || null,
        phone: phone?.trim() || null,
        address
      });
      customerId = row?.id;
    } catch (err) {
      checkoutMsg.style.color = '#b02a2a';
      checkoutMsg.textContent = 'Saving your details had a hiccup ‚Äî trying again‚Ä¶';
      const row = await getOrCreateCustomer({
        name,
        email: email?.trim().toLowerCase() || null,
        phone: phone?.trim() || null,
        address
      });
      customerId = row?.id;
    }
    if (!customerId) {
      checkoutMsg.style.color = '#b02a2a';
      checkoutMsg.textContent = 'Sorry ‚Äî we could not save your details.';
      return;
    }

    // 2) Get global sequential order ref
    let orderRef = 'RTK-???';
    try {
      orderRef = await getNextOrderRef();
    } catch (err) {
      console.warn('Falling back to timestamp-based ref');
      orderRef = 'RTK-' + Date.now();
    }

    // 3) Create order (attempt with preferred_time; if column missing, retry without)
    let orderId = null;
    const baseOrderPayload = {
      customer_id: customerId,
      subtotal: Number(subtotal.toFixed(2)),
      delivery_fee: Number(deliveryFee.toFixed(2)),
      order_type: orderType,
      notes,
      order_ref: orderRef,
    };
    let { data: order, error: orderErr } = await supabase
      .from('orders')
      .insert([{ ...baseOrderPayload, preferred_time: preferredTimeISO }])
      .select('id')
      .single();

    if (orderErr && orderErr.code === '42703') {
      const retry = await supabase.from('orders').insert([ baseOrderPayload ]).select('id').single();
      if (retry.error) return fail('Create order', retry.error);
      order = retry.data;
    } else if (orderErr) {
      return fail('Create order', orderErr);
    }
    orderId = order.id;

    // 4) Items
    const rows = itemsSnapshot.map(line => ({
      order_id: orderId,
      item_id: line.itemId,
      name: line.name,
      unit_price: Number(line.unitPrice.toFixed(2)),
      qty: line.qty,
      modifiers: (line.mods ?? []).map(m => ({ id: m.id, name: m.name, delta: m.delta })),
      spice: (typeof line.spice === 'number') ? line.spice : null,
      img: line.img || null
    }));
    const { error: itemsErr } = await supabase.from('order_items').insert(rows);
    if (itemsErr) return fail('Add order items', itemsErr);

    // (optional) confirmation hook ‚Äî non-blocking
    try {
      await fetch('https://YOUR-FUNCTION-URL/send-order-confirmation', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify({
          order_id: orderId,
          order_ref: orderRef,
          name,
          email,
          phone,
          order_type: orderType,
          preferred_time: preferredTimeRaw,
          total: subtotal + deliveryFee
        })
      });
    } catch (err) {
      console.warn('[Order] Confirmation hook failed (non-blocking)', err);
    }

    // --- SUCCESS UI ---
    checkoutMsg.textContent = '';
    checkoutModal.style.display = 'none';

    // clear basket + re-render
    basket.length = 0;
    renderOrder();

    // pretty time string
    const prefPretty = preferredTimeRaw
      ? new Date(preferredTimeRaw).toLocaleString([], { dateStyle: 'medium', timeStyle: 'short' })
      : null;

    // ensure ref is a string like RTK-012
    const refText = (orderRef && typeof orderRef === 'object')
      ? ('RTK-' + String(Number(orderRef.assigned ?? orderRef.id ?? orderRef.value ?? 0)).padStart(3,'0'))
      : String(orderRef);

    // numeric total
    const grandTotal = (Number(subtotal) || 0) + (Number(deliveryFee) || 0);

    showOrderSuccess(refText, itemsSnapshot, grandTotal, orderType, prefPretty);

  } catch (err) {
    fail('Unexpected error', err);
  }
});

  </script>
  
<script>
  // ‚Ä¶ your Supabase / checkout code ‚Ä¶

  // ‚¨áÔ∏è put this somewhere after you've defined window.formatCurrency,
  // and before the closing </script> 
</script>

  <!-- Lightbox backdrop -->
  <div id="lightbox" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);align-items:center;justify-content:center;z-index:1500">
    <img id="lightbox-img" style="max-width:92%;max-height:92%;border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,0.6)" alt="">
  </div>
  <!-- jsPDF (client-side PDF generator) -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<!-- receipt helper (put this just before </body>) -->
<script>
(function () {
  // safety: currency helper
  if (typeof window.formatCurrency !== 'function') {
    window.formatCurrency = function (n) {
      return '¬£' + Number(n || 0).toFixed(2);
    };
  }

// ‚úÖ final, ASCII-safe, UTF-8 receipt
	window.downloadReceipt = function downloadReceipt(summary, items, preferredTimeStr) {
	  const pound = '\u00A3'; // ¬£
	  const bullet = '\u2022'; // ‚Ä¢
	  const colon = '\u003A'; // :

	  const noChilli = (s = '') =>
		s.replace(/üå∂Ô∏è/g, '').replace(/üå∂/g, '').replace(/\s{2,}/g, ' ').trim();

	  const lines = [];
	  lines.push("Rung's Thai Kitchen");
	  lines.push('----------------------------------------');
	  lines.push(`Order ref: ${summary?.ref || 'RTK-???'}`);
	  lines.push(`Total: ${pound}${(summary?.total || 0).toFixed(2)}`);
	  lines.push(`Type: ${summary?.orderType || ''}`);
	  if (preferredTimeStr) lines.push(`Preferred time: ${preferredTimeStr}`);
	  lines.push('');
	  lines.push('Items');

	  (items || []).forEach((row) => {
		const cleanName = noChilli(row.name || '');
		const qty = row.qty || 1;
		const lineTotal = (row.unitPrice || 0) * qty;
		lines.push(`${qty} √ó ${cleanName} ${pound}${lineTotal.toFixed(2)}`);

		const extras = [];
		if (Array.isArray(row.mods) && row.mods.length) {
		  extras.push(row.mods.map(m => m.name).join(', '));
		}
		if (typeof row.spice === 'number') {
		  const spiceText =
			row.spice === 0 ? 'None' :
			row.spice === 1 ? 'Mild' :
			row.spice === 2 ? 'Medium' : 'Hot';
		  extras.push(`Spice: ${spiceText}`);
		}
		if (extras.length) lines.push(`‚Ä¢ ${extras.join(' ‚Ä¢ ')}`);
	  });

	  lines.push('');
	  lines.push('Thank you for ordering with Rung\'s Thai Kitchen!');

	  // make .txt UTF-8
	  const blob = new Blob([lines.join('\n')], { type: 'text/plain;charset=utf-8' });
	  const url = URL.createObjectURL(blob);
	  const a = document.createElement('a');
	  a.href = url;
	  a.download = (summary?.ref || 'receipt') + '.txt';
	  document.body.appendChild(a);
	  a.click();
	  document.body.removeChild(a);
	  URL.revokeObjectURL(url);
	};


  // 3) wire the button on the success popup (if present)
  const btn = document.getElementById('order-success-download');
  if (btn) {
    btn.addEventListener('click', function () {
      if (!window._lastOrderSummary) {
        alert('No order to download yet.');
        return;
      }
      window.downloadReceipt(
        window._lastOrderSummary,
        window._lastOrderItems,
        window._lastOrderPreferredTime
      );
    });
  }
})();
</script>
<script>
// final, plain-text, no-chilli, Windows-friendly version
window.downloadReceiptPlain = function (summary, items, preferredTimeStr) {
  // helper: strip chilli emojis
  const stripSpice = (s = '') =>
    s.replace(/üå∂Ô∏è/g, '')
     .replace(/üå∂/g, '')
     .replace(/\s{2,}/g, ' ')
     .trim();

  const lines = [];
  lines.push("Rung's Thai Kitchen");
  lines.push('----------------------------------------');
  lines.push(`Order ref: ${summary?.ref || 'RTK-???'}`);

  const totalNum = Number(summary?.total || 0);
  const totalText = (typeof window.formatCurrency === 'function')
    ? window.formatCurrency(totalNum)
    : '¬£' + totalNum.toFixed(2);
  lines.push(`Total: ${totalText}`);

  if (summary?.orderType) {
    lines.push(`Type: ${summary.orderType}`);
  }
  if (preferredTimeStr) {
    lines.push(`Preferred time: ${preferredTimeStr}`);
  }

  lines.push('');
  lines.push('Items');

  (items || []).forEach(row => {
    const name = stripSpice(row.name || '');
    const qty  = row.qty || 1;
    const lineTotal = Number(qty) * Number(row.unitPrice || 0);
    const linePrice = (typeof window.formatCurrency === 'function')
      ? window.formatCurrency(lineTotal)
      : '¬£' + lineTotal.toFixed(2);

    // main line
    lines.push(`${qty} √ó ${name} ${linePrice}`);

    // extras line
    const extras = [];
    if (Array.isArray(row.mods) && row.mods.length) {
      extras.push(row.mods.map(m => m.name).join(', '));
    }
    if (typeof row.spice === 'number') {
      const spiceText =
        row.spice === 0 ? 'None' :
        row.spice === 1 ? 'Mild' :
        row.spice === 2 ? 'Medium' : 'Hot';
      extras.push(`Spice: ${spiceText}`);
    }
    if (extras.length) {
      lines.push('‚Ä¢ ' + extras.join(' ‚Ä¢ '));
    }
  });

  lines.push('');
  lines.push('Thank you!');

  // üëá add a BOM so Windows/Notepad knows it's UTF-8
  const BOM = '\uFEFF';
  const blob = new Blob([BOM + lines.join('\n')], {
    type: 'text/plain;charset=utf-8'
  });

  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = (summary?.ref || 'receipt') + '.txt';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
};
</script>

<script>
(function setupReceiptDownload() {
  const btn = document.getElementById('order-success-pdf');
  if (!btn) return;

  btn.addEventListener('click', () => {
    const payload = window.__lastOrderForPdf;
    if (!payload) {
      alert('No order data to export yet.');
      return;
    }

    const { summary, items, preferredTimeStr } = payload;

    // this should already be defined in your Supabase / checkout script
    if (typeof window.downloadReceipt === 'function') {
      window.downloadReceipt(summary, items, preferredTimeStr);
    } else {
      alert('Order: ' + (summary?.ref || 'RTK-???'));
    }
  });
})();
</script>
<script>
(function () {
  function refreshTickerOffset() {
    const bar = document.getElementById('status-ticker');
    const visible = bar && !bar.classList.contains('hidden');
    const h = (visible ? Math.ceil(bar.getBoundingClientRect().height) : 0);
    document.documentElement.style.setProperty('--ticker-offset', (h + 12) + 'px');
  }

  // Make the marquee seamless by duplicating the text once
  function initTickerMarquee() {
    const bar = document.getElementById('status-ticker');
    if (!bar) return;
    const text = document.getElementById('ticker-text');
    const dup  = bar.querySelector('.ticker-dup');
    if (!text || !dup) return;

    dup.textContent = text.textContent;

    // Optionally tweak speed based on length (longer message = slower)
    const len = text.textContent.length;
    const base = Math.min(Math.max(len / 3, 24), 60); // 24‚Äì60s
    document.documentElement.style.setProperty('--ticker-speed', base + 's');
    document.documentElement.style.setProperty('--ticker-speed-mobile', (base + 8) + 's');
  }

  // Expose so your status loader can call after setting the message
  window.showTicker = function showTicker(message) {
    const bar = document.getElementById('status-ticker');
    const text = document.getElementById('ticker-text');
    if (!bar || !text) return;
    text.textContent = message;
    bar.classList.remove('hidden');
    initTickerMarquee();
    refreshTickerOffset();
  };

  window.hideTicker = function hideTicker() {
    const bar = document.getElementById('status-ticker');
    if (!bar) return;
    bar.classList.add('hidden');
    refreshTickerOffset();
  };

  window.addEventListener('load',  refreshTickerOffset, { passive: true });
  window.addEventListener('resize', refreshTickerOffset, { passive: true });
})();
</script>



<script>
  document.getElementById('year').textContent = new Date().getFullYear();
</script>
<!-- other small scripts -->
<script>
(function removeTickerGhost(){
  const t = document.getElementById('status-ticker');
  if (!t) return;
  const next = t.nextElementSibling;
  if (!next) return;
  const txt = (next.textContent || '').replace(/\u00A0/g,' ').trim();
  if (txt === '...' || txt === '') {
    next.remove();
  }
})();
</script>

</body>
</html>
